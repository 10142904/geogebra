#!/bin/sh
# Creates a benchmark output for the prover in CSV format to stdout
# @author Zoltan Kovacs <zoltan@geogebra.org>

PROVERS="Botana Recio PureSymbolic"
LOGFILE=.test.log
REGRESSIONFILE=.regression.out
MYDIR=`dirname $0`
MYDIR_ABSOLUTE=`cd $MYDIR; pwd`

BUILDDIR=../../../../desktop/build
test -r $BUILDDIR/geogebra.jar || exit 1 # Non-existing JAR

# Heading
echo -n "Filename;"
for j in $PROVERS; do
 echo -n "$j result;Speed;"
 done
echo

# Content
for i in *.ggb; do
 echo -n "$i;"
 for j in $PROVERS; do
  cd $MYDIR_ABSOLUTE; cd $BUILDDIR
  java -jar geogebra.jar --prover=engine:$j --logFile=$LOGFILE \
  --regressionFile=$REGRESSIONFILE $MYDIR_ABSOLUTE/$i --language=en \
  >.test.stdout 2>.test.stderr
  # Regression out file sometimes shows the wrong result:
  # RESULT=`cat $REGRESSIONFILE | grep Prove | sed 's/\(.*\) = \(.*\)/\2/'`
  RESULT=`cat $LOGFILE | grep "Statement is " | sed 's/\(.*\)Statement is \(.*\)/\2/'`
  TIME=`cat $LOGFILE | grep Benchmarking | awk '{print $5}'`
  cp $REGRESSIONFILE $REGRESSIONFILE-$i-$j
  cp $LOGFILE $LOGFILE-$i-$j
  echo -n "$RESULT;$TIME;"
  done
 echo
 done
