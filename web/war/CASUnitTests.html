<!DOCTYPE html>
<html>
<head>
<title>GeoGebra dynamic worksheet</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script src="__giac.js"></script>
<script>

var giacInput = "problem recording input to giac";
var giacOutput = "problem recording output from giac";
var logStore = "";

if (typeof String.prototype.startsWith != 'function') {
  String.prototype.startsWith = function (str){
    return this.slice(0, str.length) == str;
  };
}

var customLog = 
{
 oriLog : '',
 Log : function() 
 {
   // create string to display
   var displaystring = '';
   for(var i = 0, len = arguments.length; i < len; i++)
   {
     displaystring += arguments[i];
     if( i + 1 != len) displaystring += ', ';
   }
   //alert(displaystring);
   
   if (displaystring.startsWith("js giac  input:")) {
		giacInput = displaystring;
   } else if (displaystring.startsWith("js giac output:")) {
		giacOutput = displaystring;
   } else {
		logStore+="<br/>"+displaystring;
   }
   
   //customLog.oriLog(arguments);
 }
}



window.onload = function()
{
 if(console != null)
 { 
   customLog.oriLog = console.log;   
   console.log = customLog.Log;
 }

 console.log('test 1', 'test 2');
}
</script>
</head>
<body>

    <script>
    window.GGW_ext = {
        startupFunctions : []
    };
                                            
   GGW_ext.webReady = function(functionName, args) {
        if (typeof GGW_ext[functionName] === "function") {
            this[functionName](args);
            console.log("loaded");
        } else {
            this.startupFunctions.push([functionName,args]);
            console.log("not loaded");
        }   
    }
    </script>
    <script type="text/javascript" language="javascript" src="web/web.nocache.js"></script>
    <article class="geogebraweb" data-param-width="80" data-param-height="55" data-param-enableLabelDrags="false" data-param-enableShiftDragZoom="false"  data-param-showLogging="true" style="border: 1px solid black; display:inline-block;"
    data-param-ggbbase64="UEsDBBQACAAIAAqeYzgAAAAAAAAAAAAAAAAMAAAAZ2VvZ2VicmEueG1szVbLbts6EF23X0FoX4ekJMsCrBRGuinQxyJtFt0UlETbvJFEl6QcyV/f4UOOaydFb29R3BWlmeFw5pwzlJavh7ZBe660kF0RkRmOEO8qWYtuU0S9Wb9aRK+vXy43XG54qRhaS9UyU0QxRFp7L65fvljqrXxArHEhd4I/FJFRPY8Q6wfRCKbGj+U/vDK6iNas0dbhY992u95MwVVbvxN6er1yeXeNMG/EXtRcoUZWRUSTeWSf7rgyomJNESUYat5KJQ6yM9bwuH0NFoS0OHBoLbG25ZWreMn7qhG1YJ2t1p0EQQg9iNpsi2ie2JRcbLZQTYqpz1ZJqerbURveouELVxKqSfEsW8QxxSTHSb6A2sbgWeBZGqd4QXGaZCnNI6ShXCgkTmd5nGeYxjGOSZbFsOdZlzuY72+5McCIRmzgesJro0R9BHQnRWdu2M70ylEXB9OtGW1m6EfZdlbdpuHBRnz2cnMjG6mQsu2kkDaspV9djD32GIVdDHYR2PttKUc/yamLcGvpVxfViM6fHdogUw8ET8cIjawBkltJTZ02rORAbIT6Tph30wvwf39sxcV/6NsSpHwqgWNK8odSLq/OtLO856rjjVdIBzT1stdob5XouXF11LwSLbx6RwCEWTY+QwHeWvON4vxUbA4s58P+7Okse5SGkioDcwtlG1uynTcDk2CfamasxUq94S2HOTDjDiywT1TH9qvoOL3STegZPI84gvtJAVCS2WnebRlYZoFHt/u9rE9rt90CAq5eGKGdDQ8KXIuB1xeIlYqze6fhC9ejkMwWGOu4BoJAsr7FcByML+/20JNUGqEBh9ttxL5QdJgsAymiV840kmA6hAeXCIpWYkCrKX41Ra0obCRz9xiHrKtkekhPAOHfOl+v9uLSO5DDGojwgvIMXXDlmj9ysfotrqaR9mzNnyPr43qtuUEDdAZDO0Jfyd+h0ulc24MdjmNYDyf4n4xCgK9iynANE+gD/EVnL3CXPTlHtZJty7oadayFzZ9g6sDu0BT2+4MYtugiRuxAeAR7MznMV+Jd5iv1iUO6C7qsKh/ZgG2/P1skjR1fya/O1i8hTGcko5QuErxYkCzOaOKpzmZkTgh8v2iSkjSfE4c/zeFjFNM0x3lCclvR87OXnM/emd5FCx/ySpif6/0MQPq/A/AJoCx+T+F6sPa/gOCP2r4BI1dn0r7UdAj7qZp/vHxOEv9bQuaJY8QupV/+ICM4XBr4v14a8TmwV6dfWPfjGH6Br78DUEsHCC2mYgCuAwAANAsAAFBLAQIUABQACAAIAAqeYzgtpmIArgMAADQLAAAMAAAAAAAAAAAAAAAAAAAAAABnZW9nZWJyYS54bWxQSwUGAAAAAAEAAQA6AAAA6AMAAAAA"></article>
<div id="table">
</div>
<div id="table2">
</div>
<div id="table3">
</div>

    <script>
        var article = document.querySelector(".geogebraweb");
        GGW_ext.webReady("render", article);
		
		var green = "#00FF00";
		var blue = "#0000FF";
		var red = "#FF0000";
		var magenta = "#FF00FF";
		var yellow = "#FFFF00";
		var orange = "#FFAF00";

		function ggbOnInit() {
		
		var table = '<table border="1">';
		var table2 = '<table border="1">';
		var table3 = '<table border="1">';
		
		for (var i = 1 ; i <= Object.keys(__giac).length ; i++) {
		
			//console.clear();
		
			var cmd = __giac[i]["cmd"];
			var expectedResult = __giac[i]["result"];
			var notes = __giac[i]["notes"];
			var resultO = window.ggbApplet.evalGeoGebraCAS(""+cmd+"");
			
			if (resultO === "") {
				resultO = "GEOGEBRA ERROR";
			}
			
			var result = resultO;
			
			if (expectedResult === undefined) {
				expectedResult="RESULT MISSING";
				//expColor = "#FF00FF":
			}
			
			if (notes === undefined) {
				notes="";
			}
			
			//while (expectedResult.indexOf(" ") > -1) {
			//	expectedResult = expectedResult.replace(" ","");
			//}
			
			while (result.indexOf(" ") > -1) {
				result = result.replace(" ","");
			}
			
			// <p style="background-color:#FFFF00">
			var color = correct(result, expectedResult);
			
			var fontsize = 12;
			if (result.length > 50 || expectedResult.length > 50) {
				//fontsize = 6;
			}


			result = splitIfTooLong(result);
			expectedResult = splitIfTooLong(expectedResult);
			
			if (logStore.indexOf("Cannot enlarge memory arrays") == -1 && logStore.indexOf("geogebra.common.kernel.CASException") == -1) {
				// comment out for more debugging
				logStore = "";
			}
					
			var addToTable = "<tr>";
			addToTable += "<td>" + cmd + "</td>";
			addToTable += '<td><p style="background-color:'+color+'"><span style="font-size:'+fontsize+'pt;">' + resultO + '</span></p></td>';
			addToTable += '<td><span style="font-size:'+fontsize+'pt;">' + expectedResult + '</span></td>';
			addToTable += '<td><p style="background-color:'+yellow+'">' + notes + '</p><br/>' + giacInput + "<br/>" + giacOutput + "<br/>"+logStore+"</td>";
			addToTable += "</tr>";
			
			if (color == red) {
				table += addToTable;
			} else if (color == orange) {
				table2 += addToTable;
			} else {
				table3 += addToTable;
			}
			
			giacInput = "problem recording input to giac";
			giacOutput = "problem recording output from giac";
			logStore="";
			
		}
		
		table += "</table>";
		document.getElementById('table').innerHTML = table2;
		
		table2 += "</table>";
		document.getElementById('table2').innerHTML = table;
		
		table3 += "</table>";
		document.getElementById('table3').innerHTML = table3;
		
		}
		
		function splitIfTooLong(result) {
		
			if (result.length > 50) {
				var newStr = "";
				
				for (var i = 0 ; i < result.length; i+=50) {
				
					start = i;
					end = i + 50;
					if (end > result.length) end = result.length;
					newStr += result.substring(start, end) + "<br/>";
				}
				
				result = newStr;

			}
			
			return result;

		}
		
		function correct(result, expectedResult) {
		
			if (expectedResult == "RANDOM") {
				return magenta;
			}
		
			expectedResult = expectedResult.split("|OR|");

				for (var i = 0 ; i < expectedResult.length ; i++) {
					while (expectedResult[i].indexOf(" ") > -1) {
						expectedResult[i] = expectedResult[i].replace(" ","");
					}
					
					if (result == expectedResult[i]) {
						return green;
					}
										
				}

				if (result.startsWith("GEOGEBRA")) {
					return orange;
				}
				
				// no match
				return red;
			}


		
		
    </script>
</html>
