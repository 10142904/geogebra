<!DOCTYPE html>
<html>
<head>
<title>GeoGebra dynamic worksheet</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script>
// give more memory to giac
var Module = { TOTAL_MEMORY: 167772160 };
</script>
<script src="__giac.js"></script>
<script>

var getVars = new Array();
 var _start = 1000;
 var _end = Object.keys(__giac).length;
 var _match = undefined;
 
 // parse ?_start=55 or ?_end=200
 // or match="NSolve"
var locvartemp = ( window.location.href.indexOf( "?" ) + 1 ) ? window.location.href.substr( window.location.href.indexOf( "?" ) + 1 ) : "";
locvartemp=unescape(locvartemp);
locvartemp = locvartemp.split( "&" );
for( var x = 0; x < locvartemp.length; x++ ) {
    var lvTempVar = locvartemp[x].split( "=" );
    getVars[ unescape( lvTempVar[0] ) ] = unescape( lvTempVar[1] );
	try {
	//alert(locvartemp[x]);
	eval(locvartemp[x]);
	}
	catch (err) { } 
}

//alert(start+" "+end+" "+match);


var giacInput = "problem recording input to giac";
var giacOutput = "problem recording output from giac";
var logStore = "";

if (typeof String.prototype.startsWith != 'function') {
  String.prototype.startsWith = function (str){
    return this.slice(0, str.length) == str;
  };
}

var oldLog;

window.onload = function()
{

 if (console != null)
 { 
   oldLog = console.log;
   console.log = function(){
   
   var s = arguments[0];
	   if (s.startsWith("js giac  input:")) {
			giacInput = s;
			//alert(s);
	   } else if (s.startsWith("js giac output:")) {
			giacOutput = s;
			//alert(s);
	   }
	   
	      //oldLog.call(this, 'My Console!!!');
    oldLog.apply(this, Array.prototype.slice.call(arguments));

	   
   };
 }

}
</script>
</head>
<body>


   <script type="text/javascript" language="javascript" src="web/web.nocache.js"></script>
    <article class="geogebraweb" data-param-width="80" data-param-height="55" data-param-enableLabelDrags="false" data-param-enableShiftDragZoom="false"  data-param-showLogging="true" style="border: 1px solid black; display:inline-block;"
    data-param-ggbbase64="UEsDBBQACAAIAAqeYzgAAAAAAAAAAAAAAAAMAAAAZ2VvZ2VicmEueG1szVbLbts6EF23X0FoX4ekJMsCrBRGuinQxyJtFt0UlETbvJFEl6QcyV/f4UOOaydFb29R3BWlmeFw5pwzlJavh7ZBe660kF0RkRmOEO8qWYtuU0S9Wb9aRK+vXy43XG54qRhaS9UyU0QxRFp7L65fvljqrXxArHEhd4I/FJFRPY8Q6wfRCKbGj+U/vDK6iNas0dbhY992u95MwVVbvxN6er1yeXeNMG/EXtRcoUZWRUSTeWSf7rgyomJNESUYat5KJQ6yM9bwuH0NFoS0OHBoLbG25ZWreMn7qhG1YJ2t1p0EQQg9iNpsi2ie2JRcbLZQTYqpz1ZJqerbURveouELVxKqSfEsW8QxxSTHSb6A2sbgWeBZGqd4QXGaZCnNI6ShXCgkTmd5nGeYxjGOSZbFsOdZlzuY72+5McCIRmzgesJro0R9BHQnRWdu2M70ylEXB9OtGW1m6EfZdlbdpuHBRnz2cnMjG6mQsu2kkDaspV9djD32GIVdDHYR2PttKUc/yamLcGvpVxfViM6fHdogUw8ET8cIjawBkltJTZ02rORAbIT6Tph30wvwf39sxcV/6NsSpHwqgWNK8odSLq/OtLO856rjjVdIBzT1stdob5XouXF11LwSLbx6RwCEWTY+QwHeWvON4vxUbA4s58P+7Okse5SGkioDcwtlG1uynTcDk2CfamasxUq94S2HOTDjDiywT1TH9qvoOL3STegZPI84gvtJAVCS2WnebRlYZoFHt/u9rE9rt90CAq5eGKGdDQ8KXIuB1xeIlYqze6fhC9ejkMwWGOu4BoJAsr7FcByML+/20JNUGqEBh9ttxL5QdJgsAymiV840kmA6hAeXCIpWYkCrKX41Ra0obCRz9xiHrKtkekhPAOHfOl+v9uLSO5DDGojwgvIMXXDlmj9ysfotrqaR9mzNnyPr43qtuUEDdAZDO0Jfyd+h0ulc24MdjmNYDyf4n4xCgK9iynANE+gD/EVnL3CXPTlHtZJty7oadayFzZ9g6sDu0BT2+4MYtugiRuxAeAR7MznMV+Jd5iv1iUO6C7qsKh/ZgG2/P1skjR1fya/O1i8hTGcko5QuErxYkCzOaOKpzmZkTgh8v2iSkjSfE4c/zeFjFNM0x3lCclvR87OXnM/emd5FCx/ySpif6/0MQPq/A/AJoCx+T+F6sPa/gOCP2r4BI1dn0r7UdAj7qZp/vHxOEv9bQuaJY8QupV/+ICM4XBr4v14a8TmwV6dfWPfjGH6Br78DUEsHCC2mYgCuAwAANAsAAFBLAQIUABQACAAIAAqeYzgtpmIArgMAADQLAAAMAAAAAAAAAAAAAAAAAAAAAABnZW9nZWJyYS54bWxQSwUGAAAAAAEAAQA6AAAA6AMAAAAA"></article>
<div id="table">
</div>
<div id="table2">
</div>
<div id="table3">
</div>

    <script>
		
		var green = "#00FF00";
		var blue = "#0000FF";
		var red = "#FF0000";
		var magenta = "#FF00FF";
		var yellow = "#FFFF00";
		var orange = "#FFAF00";

		function ggbOnInit() {
		
		
		var table = '<table border="1">';
		var table2 = '<table border="1">';
		var table3 = '<table border="1">';
		
		//for (var i = 1 ; i <= Object.keys(__giac).length ; i++) {
		for (var i = _start ; i <= _end ; i++) {
		
			console.log("Starting test "+i);
		
			var cmd = __giac[i]["cmd"];
			
			// eg _match="NSolve", display just that command
			if (_match === undefined || cmd.indexOf(_match) > -1) {
			
				//alert(cmd);
				
				var expectedResult = __giac[i]["result"];
				var notes = __giac[i]["notes"];
				
				var beforeTime = +new Date();
				var resultO = window.ggbApplet.evalGeoGebraCAS(""+cmd+"");
				var afterTime = +new Date();
				var totalTime = afterTime - beforeTime;
				
				// replace c_23 with c_0
				if (resultO.indexOf("c_") > -1 && resultO.indexOf("c_") == resultO.lastIndexOf("c_")) {
					resultO = resultO.replace(/c_[0-9]*/g, "c_0");
				}
				
				// replace n_23 with n_0
				if (resultO.indexOf("n_") > -1 && resultO.indexOf("n_") == resultO.lastIndexOf("n_")) {
					resultO = resultO.replace(/n_[0-9]*/g, "n_0");
				}
				
				if (resultO === "") {
					resultO = "GEOGEBRA ERROR";
				}
				
				var result = resultO;
				
				if (expectedResult === undefined) {
					expectedResult="RESULT MISSING";
					//expColor = "#FF00FF":
				}
				
				if (notes === undefined) {
					notes="";
				}
				
				//while (expectedResult.indexOf(" ") > -1) {
				//	expectedResult = expectedResult.replace(" ","");
				//}
				
				while (result.indexOf(" ") > -1) {
					result = result.replace(" ","");
				}
				
				// <p style="background-color:#FFFF00">
				var color = correct(result, expectedResult);
				
				var fontsize = 12;
				if (result.length > 50 || expectedResult.length > 50) {
					//fontsize = 6;
				}


				result = splitIfTooLong(result);
				expectedResult = splitIfTooLong(expectedResult);
				
				if (logStore.indexOf("Cannot enlarge memory arrays") == -1 && logStore.indexOf("geogebra.common.kernel.CASException") == -1) {
					// comment out for more debugging
					logStore = "";
				}
				
				if (totalTime > 500) {
					totalTime = '<br><p style="background-color:'+red+'">' + totalTime + 'ms</p>' ;
				} else {
					totalTime = "";
				}
						
				var addToTable = "<tr>";
				addToTable += "<td>" + i + ': ' + cmd.replace(/</g,"&lt;") +  totalTime + "</td>";
				addToTable += '<td><p style="background-color:'+color+'"><span style="font-size:'+fontsize+'pt;">' + resultO +'</span></p></td>';
				addToTable += '<td><span style="font-size:'+fontsize+'pt;">' + expectedResult.replace(/<br\/>/g,"BREAK").replace(/</g,"&lt;").replace(/BREAK/g,"<br/>") + '</span></td>';
				addToTable += '<td><p style="background-color:'+yellow+'">' + notes + '</p><br/>' + giacInput + "<br/>" + giacOutput + "<br/>"+logStore+"</td>";
				addToTable += "</tr>";
				
				if (color == red) {
					table += addToTable;
				} else if (color == orange) {
					table2 += addToTable;
				} else {
					table3 += addToTable;
				}
				
				giacInput = "problem recording input to giac";
				giacOutput = "problem recording output from giac";
				logStore="";
			
			}
			
		}
		
		table += "</table>";
		document.getElementById('table').innerHTML = table2;
		
		table2 += "</table>";
		document.getElementById('table2').innerHTML = table;
		
		table3 += "</table>";
		document.getElementById('table3').innerHTML = table3;
		
		alert("Finished")
		
		}
		
		function splitIfTooLong(result) {
		
			if (result.length > 50) {
				var newStr = "";
				
				for (var i = 0 ; i < result.length; i+=50) {
				
					start = i;
					end = i + 50;
					if (end > result.length) end = result.length;
					newStr += result.substring(start, end) + "<br/>";
				}
				
				result = newStr;

			}
			
			return result;

		}
		
		function correct(result, expectedResult) {
		
			if (expectedResult == "RANDOM") {
				return magenta;
			}
		
			expectedResult = expectedResult.split("|OR|");

				for (var i = 0 ; i < expectedResult.length ; i++) {
					while (expectedResult[i].indexOf(" ") > -1) {
						expectedResult[i] = expectedResult[i].replace(" ","");
					}
					
					if (result == expectedResult[i]) {
						return green;
					}
										
				}

				if (result.startsWith("GEOGEBRA")) {
					return orange;
				}
				
				// no match
				return red;
			}


		
		
    </script>
</html>
