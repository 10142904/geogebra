/* adapted from https://github.com/hughsk/png-chunks-extract (MIT) and https://github.com/SheetJS/js-crc32 (Apache 2.0) (C) 2014-present SheetJS -- http://sheetjs.com */
window.rewrite_pHYs_chunk=function(r,e,n){var o;!function(r){"undefined"==typeof DO_NOT_EXPORT_CRC?"object"==typeof exports?r(exports):"function"==typeof define&&define.amd?define(function(){var e={};return r(e),e}):r(o={}):r(o={})}(function(r){function e(r,e){for(var o=-1^e,t=r.length-7,a=0;a<t;)o=(o=(o=(o=(o=(o=(o=(o=o>>>8^n[255&(o^r[a++])])>>>8^n[255&(o^r[a++])])>>>8^n[255&(o^r[a++])])>>>8^n[255&(o^r[a++])])>>>8^n[255&(o^r[a++])])>>>8^n[255&(o^r[a++])])>>>8^n[255&(o^r[a++])])>>>8^n[255&(o^r[a++])];for(;a<t+7;)o=o>>>8^n[255&(o^r[a++])];return-1^o}r.version="1.1.1";var n=function(){for(var r=0,e=new Array(256),n=0;256!=n;++n)r=1&(r=1&(r=1&(r=1&(r=1&(r=1&(r=1&(r=1&(r=n)?-306674912^r>>>1:r>>>1)?-306674912^r>>>1:r>>>1)?-306674912^r>>>1:r>>>1)?-306674912^r>>>1:r>>>1)?-306674912^r>>>1:r>>>1)?-306674912^r>>>1:r>>>1)?-306674912^r>>>1:r>>>1)?-306674912^r>>>1:r>>>1,e[n]=r;return"undefined"!=typeof Int32Array?new Int32Array(e):e}();r.table=n,r.bstr=function(r,e){for(var o=-1^e,t=r.length-1,a=0;a<t;)o=(o=o>>>8^n[255&(o^r.charCodeAt(a++))])>>>8^n[255&(o^r.charCodeAt(a++))];return a===t&&(o=o>>>8^n[255&(o^r.charCodeAt(a))]),-1^o},r.buf=function(r,o){if(r.length>1e4)return e(r,o);for(var t=-1^o,a=r.length-3,f=0;f<a;)t=(t=(t=(t=t>>>8^n[255&(t^r[f++])])>>>8^n[255&(t^r[f++])])>>>8^n[255&(t^r[f++])])>>>8^n[255&(t^r[f++])];for(;f<a+3;)t=t>>>8^n[255&(t^r[f++])];return-1^t},r.str=function(r,e){for(var o,t,a=-1^e,f=0,i=r.length;f<i;)(o=r.charCodeAt(f++))<128?a=a>>>8^n[255&(a^o)]:o<2048?a=(a=a>>>8^n[255&(a^(192|o>>6&31))])>>>8^n[255&(a^(128|63&o))]:o>=55296&&o<57344?(o=64+(1023&o),t=1023&r.charCodeAt(f++),a=(a=(a=(a=a>>>8^n[255&(a^(240|o>>8&7))])>>>8^n[255&(a^(128|o>>2&63))])>>>8^n[255&(a^(128|t>>6&15|(3&o)<<4))])>>>8^n[255&(a^(128|63&t))]):a=(a=(a=a>>>8^n[255&(a^(224|o>>12&15))])>>>8^n[255&(a^(128|o>>6&63))])>>>8^n[255&(a^(128|63&o))];return-1^a}});var t=new Uint8Array(4),a=new Int32Array(t.buffer),f=new Uint32Array(t.buffer);if(137!==r[0]||80!==r[1]||78!==r[2]||71!==r[3]||13!==r[4]||10!==r[5]||26!==r[6]||10!==r[7])throw new Error("Invalid .png file header: possibly caused by DOS-Unix line ending conversion?");for(var i=8;i<r.length;){t[3]=r[i++],t[2]=r[i++],t[1]=r[i++],t[0]=r[i++];var d=f[0]+4,h=new Uint8Array(d);h[0]=r[i++],h[1]=r[i++],h[2]=r[i++],h[3]=r[i++];var u=String.fromCharCode(h[0])+String.fromCharCode(h[1])+String.fromCharCode(h[2])+String.fromCharCode(h[3]);console.log("chunk found "+u+", length = "+(d-4));for(var c=i,C=4;C<d;C++)h[C]=r[i++];var l=i;t[3]=r[i++],t[2]=r[i++],t[1]=r[i++],t[0]=r[i++];var A=a[0],s=o.buf(h);if(s!==A)throw new Error("CRC values for "+u+" header do not match, PNG file is likely corrupted");if(console.log("CRCs match! "+s+" "+A+" "+h.length),"IDAT"==u){c-=8;for(var v=r.length,g=new Uint8Array(v+21),C=0;C<c;C++)g[C]=r[C];for(C=c;C<v;C++)g[C+21]=r[C];var w=new Uint8Array(13),C=0;a[0]=9,g[c++]=t[3],g[c++]=t[2],g[c++]=t[1],g[c++]=t[0],w[C++]=g[c++]="p".charCodeAt(0),w[C++]=g[c++]="H".charCodeAt(0),w[C++]=g[c++]="Y".charCodeAt(0),w[C++]=g[c++]="s".charCodeAt(0),f[0]=e,w[C++]=g[c++]=t[3],w[C++]=g[c++]=t[2],w[C++]=g[c++]=t[1],w[C++]=g[c++]=t[0],f[0]=n,w[C++]=g[c++]=t[3],w[C++]=g[c++]=t[2],w[C++]=g[c++]=t[1],w[C++]=g[c++]=t[0],w[C++]=g[c++]=1;y=o.buf(w);return a[0]=y,g[c++]=t[3],g[c++]=t[2],g[c++]=t[1],g[c++]=t[0],g}if("pHYs"==u){console.log("pHYs chunk found, rewriting!!!!!!!!!!!!!");C=0;(w=new Uint8Array(13))[C++]="p".charCodeAt(0),w[C++]="H".charCodeAt(0),w[C++]="Y".charCodeAt(0),w[C++]="s".charCodeAt(0),f[0]=e,w[C++]=r[c++]=t[3],w[C++]=r[c++]=t[2],w[C++]=r[c++]=t[1],w[C++]=r[c++]=t[0],f[0]=n,w[C++]=r[c++]=t[3],w[C++]=r[c++]=t[2],w[C++]=r[c++]=t[1],w[C++]=r[c++]=t[0],w[C++]=r[c++]=1;var y=o.buf(w);return a[0]=y,r[l++]=t[3],r[l++]=t[2],r[l++]=t[1],r[l++]=t[0],r}}throw new Error(".png file ended prematurely: no IEND or pHYs header was found")};

