/* A canvas to PDF converter. Uses a mock canvas context to build a PDF document. Licensed under the MIT license: http://www.opensource.org/licenses/mit-license.php Author: Joshua Gould Copyright (c) 2017 Joshua Gould */
/* PDFKit MIT LICENSE Copyright (c) 2014 Devon Govett Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions: The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software. THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE. */
function PDFKitMini(){this.objects=[],this.catalog=this.add(new PDFCatalog),this.pages=this.add(new PDFPages),this.catalog.setPages(this.pages),this.pageWidth=8.27,this.pageHeight=11.69,this.textStyle=new PDFTextStyle,this.fonts=[],this.lineWidth=1,this.lineEndType=0,this.alpha=1,this.images=[]}function PDFCatalog(){}function PDFPages(){this.pages=[]}function PDFPage(t,e,i){this.pdf=t,this.fonts=[],this.images=[],this.imageInstances=[],this.alphas=[],this.fillColor="0 0 0 ",this.strokeColor="0 0 0 ",this.lineWidth=2,this.lineCap=0,this.lineJoin=1,this.fontSize=12,this.font="normal",this.width=72*e,this.height=72*i,this._ctm=[1,0,0,1,0,0]}function PDFFont(t){this.fontName=t}function PDFStream(){this.stream=""}function PDFImage(t){this.width=t.width,this.height=t.height;for(var e=[],i=t.getContext("2d").getImageData(0,0,this.width,this.height),o=0;o<this.height;o++)for(var n=0;n<this.width;n++){var r=i.data[4*(n+o*this.width)],s=i.data[4*(n+o*this.width)+1],a=i.data[4*(n+o*this.width)+2];e.push(String.fromCharCode(r)),e.push(String.fromCharCode(s)),e.push(String.fromCharCode(a))}this.stream=e.join("")}function PDFTextStyle(){this.fontName="Helvetica",this.fontSize=12,this.italic=!1,this.bold=!1,this.font=void 0,this.alpha=1}!function(t){"use strict";function e(t,e,o,n){t=t%360+360*(t<0),e=isNaN(t)||isNaN(e)?0:e;var r=o+(o<.5?o:1-o)*e,s=2*o-r;return l(i(t>=240?t-240:t+120,s,r),i(t,s,r),i(t<120?t+240:t-120,s,r),n)}function i(t,e,i){return 255*(t<60?e+(i-e)*t/60:t<180?i:t<240?e+(i-e)*(240-t)/60:e)}var o=void 0!==o?o:{};"undefined"!=typeof module&&module.exports?module.exports=o:"function"==typeof define&&define.amd?define(function(){return o}):t.canvas2pdf=o;var n="\\s*([+-]?\\d+)\\s*",r="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",s="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",a=new RegExp("^rgb\\("+[n,n,n]+"\\)$"),h=new RegExp("^rgb\\("+[s,s,s]+"\\)$"),c=new RegExp("^rgba\\("+[n,n,n,r]+"\\)$"),p=new RegExp("^rgba\\("+[s,s,s,r]+"\\)$"),f=new RegExp("^hsl\\("+[r,s,s]+"\\)$"),d=new RegExp("^hsla\\("+[r,s,s,r]+"\\)$"),l=function(t,e,i,o){return{c:t/255+" "+e/255+" "+i/255,a:o}},u=function(t){if(!t.startsWith("rgb")&&!t.startsWith("hsl")){var i=document.createElement("div");i.style.color=t,document.body.appendChild(i),t=window.getComputedStyle(i).color+"",document.body.removeChild(i)}var o,n=((t=t.replace(/\s/g,""))+"").trim().toLowerCase();return(o=a.exec(n))?l(o[1],o[2],o[3],1):(o=h.exec(n))?l(255*o[1]/100,255*o[2]/100,255*o[3]/100,1):(o=c.exec(n))?l(o[1],o[2],o[3],o[4]):(o=p.exec(n))?l(255*o[1]/100,255*o[2]/100,255*o[3]/100,o[4]):(o=f.exec(n))?e(o[1],o[2]/100,o[3]/100):(o=d.exec(n))?e(o[1],o[2]/100,o[3]/100,o[4]):{c:t,a:1}};o.PdfContext=function(t,e){var i=this,o=new PDFKitMini;this.doc=o,o.pageSetWidth(t/72),o.pageSetHeight(e/72),o.addPage();var n="10px Helvetica";this.textAlign="left",this.textBaseline="alphabetic";var r=function(){var t=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-,\'\"\sa-z]+?)\s*$/i,e=t.exec(i.font);return e||(console.log("error parsing font "+i.font),e=t.exec("10px Helvetica")),e[6].indexOf("sans-serif")>-1&&(e[6]="Helvetica"),e[6].indexOf("serif")>-1&&(e[6]="Times-Roman"),{style:e[1]||"normal",size:parseInt(e[4])||10,family:e[6]||"Helvetica",weight:e[3]||"normal"}};Object.defineProperty(this,"fillStyle",{get:function(){return this.fillColor},set:function(t){this.fillColor=t;var e=u(t);i.doc.fillColor(e.c,e.a)}}),Object.defineProperty(this,"strokeStyle",{get:function(){return i.doc.strokeColor()},set:function(t){var e=u(t);i.doc.strokeColor(e.c,e.a)}}),Object.defineProperty(this,"lineWidth",{get:function(){return i.doc.setLineWidth()},set:function(t){i.doc.setLineWidth(t)}}),Object.defineProperty(this,"lineCap",{get:function(){return"butt"},set:function(t){i.doc.lineCap(t)}}),Object.defineProperty(this,"lineJoin",{get:function(){return"miter"},set:function(t){i.doc.lineJoin(t)}}),Object.defineProperty(this,"miterLimit",{get:function(){return 10},set:function(t){}}),Object.defineProperty(this,"globalAlpha",{get:function(){return i.doc.opacity()},set:function(t){i.doc.opacity(t)}}),Object.defineProperty(this,"font",{get:function(){return n},set:function(t){n=t;var e=r();i.doc.fontSize(e.size),i.doc.font(e.family),i.doc.setFontStyle("normal"!=e.weight,"normal"!=e.style,!1)}}),this.font=n,this.strokeStyle="rgb(0,0,0)",this.fillStyle="rgb(0,0,0)"},o.PdfContext.prototype.end=function(){this.doc.end()},o.PdfContext.prototype.save=function(){this.doc.save()},o.PdfContext.prototype.restore=function(){this.doc.restore()},o.PdfContext.prototype.transform=function(t,e,i,o,n,r){this.doc.transform(t,e,i,o,n,r)},o.PdfContext.prototype.scale=function(t,e){this.doc.scale(t,e)},o.PdfContext.prototype.rotate=function(t){var e=180*t/Math.PI;this.doc.rotate(e)},o.PdfContext.prototype.translate=function(t,e){this.doc.translate(t,e)},o.PdfContext.prototype.beginPath=function(){this.doc.beginPath()},o.PdfContext.prototype.moveTo=function(t,e){this.doc.moveTo(t,e)},o.PdfContext.prototype.closePath=function(){this.doc.closePath()},o.PdfContext.prototype.lineTo=function(t,e){this.doc.lineTo(t,e)},o.PdfContext.prototype.stroke=function(){this.doc.stroke()},o.PdfContext.prototype.fill=function(t){this.doc.fill(t)},o.PdfContext.prototype.rect=function(t,e,i,o){this.doc.rect(t,e,i,o)},o.PdfContext.prototype.fillRect=function(t,e,i,o){this.doc.beginPath(),this.doc.rect(t,e,i,o),this.doc.fill()},o.PdfContext.prototype.strokeRect=function(t,e,i,o){this.doc.beginPath(),this.doc.rect(t,e,i,o),this.doc.stroke()},o.PdfContext.prototype.clearRect=function(t,e,i,o){var n=this.doc.fillColor();this.doc.fillColor("white"),this.doc.rect(t,e,i,o),this.doc.fill(),this.doc.fillColor(n)},o.PdfContext.prototype.arc=function(t,e,i,o,n,r){this.doc.arc(t,e,i,o,n,r)},o.PdfContext.prototype.bezierCurveTo=function(t,e,i,o,n,r){this.doc.bezierCurveTo(t,e,i,o,n,r)},o.PdfContext.prototype.quadraticCurveTo=function(t,e,i,o){this.doc.quadraticCurveTo(t,e,i,o)},o.PdfContext.prototype.createLinearGradient=function(t,e,i,o){var n=this.doc.linearGradient(t,e,i,o);return n.addColorStop=function(t,e){var i=u(e);n.stop(t,i.c,i.a)},n},o.PdfContext.prototype.createRadialGradient=function(t,e,i,o,n,r){var s=this.doc.radialGradient(t,e,i,o,n,r);return s.addColorStop=function(t,e){var i=u(e);s.stop(t,i.c,i.a)},s},o.PdfContext.prototype.fillText=function(t,e,i){this.doc.textAdd(e,i,t)},o.PdfContext.prototype.strokeText=function(t,e,i){console.log("strokeText not implemented, use fillText")},o.PdfContext.prototype.measureText=function(t){return document.createElement("canvas").getContext("2d").measureText(t+"")},o.PdfContext.prototype.clip=function(){this.doc.clip()},o.PdfContext.prototype.getPDFbase64=function(){return this.doc.getBase64Text()},o.PdfContext.prototype.getPDFtext=function(){return this.doc.getText()},o.PdfContext.prototype.drawImage=function(t,e,i,o,n){return this.doc.drawImage(t,e,i,o,n)},o.PdfContext.prototype.setLineDash=function(t){return this.doc.setLineDash(t)},o.PdfContext.prototype.setTransform=function(){console.log("setTransform not implemented")},o.PdfContext.prototype.createPattern=function(t,e){console.log("createPattern not implemented")},o.PdfContext.prototype.drawFocusRing=function(){console.log("drawFocusRing not implemented")},o.PdfContext.prototype.createImageData=function(){console.log("drawFocusRing not implemented")},o.PdfContext.prototype.getImageData=function(){console.log("getImageData not implemented")},o.PdfContext.prototype.putImageData=function(){console.log("putImageData not implemented")},o.PdfContext.prototype.globalCompositeOperation=function(){console.log("globalCompositeOperation not implemented")},o.PdfContext.prototype.arcTo=function(t,e,i,o,n){console.log("arcTo not implemented")}}("undefined"!=typeof window?window:this),PDFKitMini.prototype.add=function(t){return this.objects.push(t),t.id=this.objects.length,t},PDFKitMini.prototype.pageSetWidth=function(t){this.pageWidth=t},PDFKitMini.prototype.pageSetHeight=function(t){this.pageHeight=t},PDFKitMini.prototype.addPage=function(){this.currentPage=new PDFPage(this,this.pageWidth,this.pageHeight),this.add(this.currentPage),this.pages.addPage(this.currentPage);var t=new PDFStream;this.add(t),this.currentPage.setStream(t)},PDFKitMini.prototype.font=function(t){this.currentPage.setFontName(t)},PDFKitMini.prototype.fontSize=function(t){this.currentPage.setFontSize(t)},PDFKitMini.prototype.lineJoin=function(t){this.currentPage.setLineJoin(t)},PDFKitMini.prototype.lineCap=function(t){this.currentPage.setLineCap(t)},PDFKitMini.prototype.setLineWidth=function(t){this.currentPage.setLineWidth(t)},PDFKitMini.prototype.strokeColor=function(t,e){this.currentPage.setStrokeColor(t,e)},PDFKitMini.prototype.fillColor=function(t,e){this.currentPage.setFillColor(t,e)},PDFKitMini.prototype.pageSetCurrent=function(t){this.currentPage=t},PDFKitMini.prototype.font=function(t){this.textStyle.setFontName(t)},PDFKitMini.prototype.fontSetSize=function(t){this.textStyle.fontSetSize(t)},PDFKitMini.prototype.setFontStyle=function(t,e){this.textStyle.setFontStyle(t,e)},PDFKitMini.prototype.fontSetColor=function(t,e,i){this.textStyle.setColor(new PDFColor(t,e,i))},PDFKitMini.prototype.setFont=function(t){var e=t.getFontName();if(null!=e){var i,o=null;for(i=0;i<this.fonts.length;i++)this.fonts[i].fontName==e&&(o=this.fonts[i]);null==o&&(o=new PDFFont(e),this.add(o),this.fonts.push(o)),t.setFont(o)}},PDFKitMini.prototype.textAdd=function(t,e,i){var o=this.textStyle.clone();this.setFont(o),this.currentPage.textAdd(t,e,i,o)},PDFKitMini.prototype.imageLoadFromCanvas=function(t){t=new PDFImage(t),this.add(t),this.images.push(t),this.currentImage=t},PDFKitMini.prototype.doDrawImage=function(t,e,i,o){this.currentPage.drawImage(t,e,this.currentImage,this.alpha,i,o)},PDFKitMini.prototype.moveTo=function(t,e){this.currentPage.moveTo(t,e)},PDFKitMini.prototype.lineTo=function(t,e){this.currentPage.lineTo(t,e)},PDFKitMini.prototype.bezierCurveTo=function(t,e,i,o,n,r){this.currentPage.bezierCurveTo(t,e,i,o,n,r)},PDFKitMini.prototype.translate=function(t,e){this.currentPage.translate(t,e)},PDFKitMini.prototype.transform=function(t,e,i,o,n,r){this.currentPage.transform(t,e,i,o,n,r)},PDFKitMini.prototype.drawImage=function(t,e,i,o,n){if("img"==t.nodeName.toLowerCase()){var r=document.createElement("canvas");r.width=t.width,r.height=t.height,r.getContext("2d").drawImage(t,0,0),t=r}this.imageLoadFromCanvas(t),this.doDrawImage(e,i,t.width,t.height)},PDFKitMini.prototype.scale=function(t,e,i){this.currentPage.scale(t,e,i)},PDFKitMini.prototype.rotate=function(t,e){this.currentPage.rotate(t,e)},PDFKitMini.prototype.beginPath=function(){this.currentPage.beginPath()},PDFKitMini.prototype.arc=function(t,e,i,o,n,r){this.currentPage.arc(t,e,i,o,n,r)},PDFKitMini.prototype.closePath=function(){this.currentPage.closePath()},PDFKitMini.prototype.stroke=function(){this.currentPage.stroke()},PDFKitMini.prototype.clip=function(t){this.currentPage.clip(t)},PDFKitMini.prototype.opacity=function(t){this.currentPage.setAlpha(t)},PDFKitMini.prototype.setLineDash=function(t){this.currentPage.setLineDash(t)},PDFKitMini.prototype.save=function(){this.currentPage.saveContext()},PDFKitMini.prototype.restore=function(){this.currentPage.restoreContext()},PDFKitMini.prototype.fill=function(t){this.currentPage.fill(t)},PDFKitMini.prototype.rect=function(t,e,i,o){this.currentPage.rect(t,e,i,o)},PDFKitMini.prototype.quadraticCurveTo=function(t,e,i,o){this.currentPage.quadraticCurveTo(t,e,i,o)},PDFKitMini.prototype.graphicsSetAlpha=function(t){this.alpha=Math.floor(100*t/255)/100,this.textStyle.setAlpha(t)},PDFKitMini.prototype.graphicsSetLineEndType=function(t){this.lineEndType=t},PDFKitMini.prototype._write=function(t){this.stream+=t+"\n"},PDFKitMini.prototype.getObject=function(t){this.stream="",this._write("%PDF-1.0");var e,i;for(e=0;e<this.objects.length;e++)(i=this.objects[e]).offset=this.stream.length,i=i.getObject(this,t),this._write(i);t=this.stream.length,this._write("xref"),this._write("0 "+(this.objects.length+1)),this._write("0000000000 65535 f");var o=this.objects;for(e=0;e<o.length;e++){var n=("0000000000"+(n=this.objects[e].offset)).slice(-10);this._write(n+" 00000 n")}return this._write("trailer"),this._write(PDFObject.convert({Size:this.objects.length+1,Root:new PDFReference(this.catalog.id+" 0 R")})),this._write("startxref"),this._write(t),this._write("%%EOF"),this.stream},PDFKitMini.prototype.getBase64Text=function(){return"data:application/pdf;base64,"+btoa(this.getObject(this))},PDFCatalog.prototype.setPages=function(t){this.props={Type:"Catalog",Pages:new PDFReference(t.id+" 0 R")}},PDFCatalog.prototype.getObject=function(t){return PDFObject.makeObject(this.props,this.id)},PDFPages.prototype.addPage=function(t){return this.pages.push(t),t.setPageNumber(this.pages.length),t},PDFPages.prototype.getObject=function(t){var e={Type:"Pages",Count:this.pages.length,Kids:new PDFReference("[3 0 R]")};return PDFObject.makeObject(e,this.id)},PDFPage.prototype.setStream=function(t){this.pdfStream=t,this.transform(1,0,0,-1,0,this.height)},PDFPage.prototype.setPageNumber=function(t){this.pageNumber=t},PDFPage.prototype.textAdd=function(t,e,i,o){var n=this.fontSize;-1==this.fonts.indexOf(o.font)&&this.fonts.push(o.font),i=PDFObject.convert(new String(i)),this.setAlpha(o.alpha),e=this.height-e,this.saveContext(),this.transform(1,0,0,-1,0,this.height),this.pdfStream.addText("BT "+this.strokeColor+" rg /F"+o.font.id+" "+n+" Tf 1 0 0 1 "+t+" "+e+" cm "+i+"Tj ET "),this.restoreContext()},PDFPage.prototype.setAlpha=function(t){if(t!=this.currentAlpha){for(var e=!1,i=0;!e&&i<this.alphas.length;)this.alphas[i]==t?e=!0:i++;e||this.alphas.push(t),this.pdfStream.addText("/EGS"+i+" gs "),this.currentAlpha=t}},PDFPage.prototype.moveTo=function(t,e){this.pdfStream.addText(t+" "+e+" m ")},PDFPage.prototype.setLineWidth=function(t){this.lineWidth=t},PDFPage.prototype.lineTo=function(t,e){this.pdfStream.addText(t+" "+e+" l ")},PDFPage.prototype.bezierCurveTo=function(t,e,i,o,n,r){this.pdfStream.addText(t+" "+e+" "+i+" "+o+" "+n+" "+r+" c ")},PDFPage.prototype.transform=function(t,e,i,o,n,r){var s,a,h,c,p,f,d,l,u;a=(s=this._ctm)[0],h=s[1],c=s[2],p=s[3],f=s[4],d=s[5],s[0]=a*t+c*e,s[1]=h*t+p*e,s[2]=a*i+c*o,s[3]=h*i+p*o,s[4]=a*n+c*r+f,s[5]=h*n+p*r+d,u=function(){var s,a,h,c;for(c=[],s=0,a=(h=[t,e,i,o,n,r]).length;s<a;s++)l=h[s],c.push(+l.toFixed(5));return c}().join(" "),this.pdfStream.addText(u+" cm ")},PDFPage.prototype.translate=function(t,e){this.transform(1,0,0,1,t,e)},PDFPage.prototype.rotate=function(t,e){var i,o,n,r,s,a,h;null==e&&(e={}),o=t*Math.PI/180,i=Math.cos(o),n=Math.sin(o),r=s=0,null!=e.origin&&(a=(r=(h=e.origin)[0])*n+(s=h[1])*i,r-=r*i-s*n,s-=a),this.transform(i,n,-n,i,r,s)},PDFPage.prototype.scale=function(t,e,i){var o,n,r;null==e&&(e=t),null==i&&(i={}),o=n=0,null!=i.origin&&(o=(r=i.origin)[0],n=r[1],o-=t*o,n-=e*n),this.transform(t,0,0,e,o,n)},PDFPage.prototype.stroke=function(){this.pdfStream.addTextCheckMerge("S ")},PDFPage.prototype.clip=function(t){this.pdfStream.addText((/even-?odd/.test(t)?"W* ":"W ")+" n ")},PDFPage.prototype.setLineDash=function(t){this.lineDash=t},PDFPage.prototype.saveContext=function(){this.pdfStream.addText("q ")},PDFPage.prototype.restoreContext=function(){this.pdfStream.addText("Q ")},PDFPage.prototype.fill=function(t){this.pdfStream.addTextCheckMerge(/even-?odd/.test(t)?"f* ":"f ")},PDFPage.prototype.beginPath=function(){if(this.lineDash){this.pdfStream.addText("[");for(var t=0;t<this.lineDash.length;t++)this.pdfStream.addText(this.lineDash[t]),this.pdfStream.addText(" ");this.pdfStream.addText("] 0 d ")}this.setAlpha(this.alpha),this.pdfStream.addText(this.lineCap+" J "+this.lineJoin+" j "+(1|this.lineWidth)+" w "+this.fillColor+" rg "+this.strokeColor+" RG ")},PDFPage.prototype.setStrokeColor=function(t,e){this.strokeColor=t||"0 0 0",this.alpha=e},PDFPage.prototype.setFillColor=function(t,e){this.fillColor=t||"0 0 0",this.alpha=e},PDFPage.prototype.closePath=function(){this.pdfStream.addText("h ")},PDFPage.prototype.quadraticCurveTo=function(t,e,i,o){return this.pdfStream.addText(t+" "+e+" "+i+" "+o+" v ")},PDFPage.prototype._bezierCurve=function(t,e,i,o,n,r){var s=Math.PI,a=i,h=o,c=Math.cos(n*s/180),p=Math.sin(n*s/180),f=Math.cos((n+r)*s/180),d=Math.sin((n+r)*s/180),l=t+a*c,u=e-h*p,g=-a*p,P=-h*c,m=t+a*f,y=e-h*d,F=-a*d,D=-h*f,x=Math.tan(r/2*s/180),C=Math.sin(r*s/180)*(Math.sqrt(4+3*x*x)-1)/3;Math.sqrt(g*g+P*P),Math.sqrt(F*F+D*D);return[l,u,l+C*g,u+C*P,m-C*F,y-C*D,m,y]},PDFPage.prototype.arc=function(t,e,i,o,n,r){o*=180/Math.PI,n*=180/Math.PI,width=i-1,height=i-1;for(var s=Math.ceil(Math.abs(n/45)),a=o,h=n/s,c=0;c<s;c++){var p=this._bezierCurve(t,e,width,height,a,h);0==c&&this.moveTo(p[0],p[1]),this.bezierCurveTo(p[2],p[3],p[4],p[5],p[6],p[7]),a+=h}},PDFPage.prototype.rect=function(t,e,i,o){var n=t+i,r=e+o;this.pdfStream.addText(t+" "+e+" m "+n+" "+e+" l "+n+" "+r+" l "+t+" "+r+" l "+t+" "+e+" l ")},PDFPage.prototype._CAP_STYLES={BUTT:0,ROUND:1,SQUARE:2},PDFPage.prototype.setLineCap=function(t){"string"==typeof t&&(t=this._CAP_STYLES[t.toUpperCase()]),this.lineCap=t},PDFPage.prototype._JOIN_STYLES={MITER:0,ROUND:1,BEVEL:2},PDFPage.prototype.setLineJoin=function(t){"string"==typeof t&&(t=this._JOIN_STYLES[t.toUpperCase()]),this.lineJoin=t},PDFPage.prototype.setFontSize=function(t){this.fontSize=t},PDFPage.prototype.transform=function(t,e,i,o,n,r){var s,a,h,c,p,f,d,l,u;a=(s=this._ctm)[0],h=s[1],c=s[2],p=s[3],f=s[4],d=s[5],s[0]=a*t+c*e,s[1]=h*t+p*e,s[2]=a*i+c*o,s[3]=h*i+p*o,s[4]=a*n+c*r+f,s[5]=h*n+p*r+d,u=function(){var s,a,h,c;for(c=[],s=0,a=(h=[t,e,i,o,n,r]).length;s<a;s++)l=h[s],c.push(+l.toFixed(5));return c}().join(" "),this.pdfStream.addText(u+" cm ")},PDFPage.prototype.drawImage=function(t,e,i,o,n,r){var s={width:n,height:r,x:t,y:e,image:i,alpha:o};this.saveContext(),this.transform(1,0,0,-1,0,0),this.translate(t,-r-e),this.scale(n,r),this.pdfStream.addText("/Im"+i.id+" Do "),this.restoreContext(),-1==this.images.indexOf(i)&&this.images.push(i),this.imageInstances.push(s)},PDFPage.prototype.getObject=function(t){t.pageSetCurrent(this);var i={Type:"Page"};i.MediaBox=[0,0,this.width,this.height],i.Contents=new PDFReference(this.pdfStream.id+" 0 R");var o="<<";if(0<this.fonts.length)for(c=0;c<this.fonts.length;c++)e=this.fonts[c],o+="/F"+e.id+" "+e.id+" 0 R";o+=">>";var n={};if(0<this.alphas.length)for(c=0;c<this.alphas.length;c++){var r=this.alphas[c];(isNaN(r)||void 0===r)&&(r="1"),"string"==typeof r&&(r*=1),n["EGS"+c]={CA:r,ca:r}}var s="<<";if(0<this.images.length)for(d=0;d<this.images.length;d++)e=this.images[d],s+="/Im"+e.id+" "+e.id+" 0 R";return s+=">>",i.Resources={Font:new PDFReference(o),ExtGState:n,XObject:new PDFReference(s)},PDFObject.makeObject(i,this.id)},PDFFont.TIMES=["Times-Roman","Times-Italic","Times-Bold","Times-BoldItalic"],PDFFont.HELVETICA=["Helvetica","Helvetica-Oblique","Helvetica-Bold","Helvetica-BoldOblique"],PDFFont.getPDFName=function(t,e,i){var o=(e?2:0)+(i?1:0);return"Helvetica"==t?PDFFont.HELVETICA[o]:PDFFont.TIMES[o]},PDFFont.prototype.getObject=function(t){var e={Subtype:"Type1",Name:"F"+this.id,BaseFont:this.fontName,Encoding:"WinAnsiEncoding",Type:"Font"};return PDFObject.makeObject(e,this.id)},PDFStream.prototype.addText=function(t){this.stream+=t},PDFStream.prototype.addTextCheckMerge=function(t){"f* "==t&&this.stream.endsWith(" S ")?this.stream=this.stream.substring(0,this.stream.length-3)+" B* ":"S "==t&&this.stream.endsWith(" f* ")?this.stream=this.stream.substring(0,this.stream.length-4)+" B* ":"f "==t&&this.stream.endsWith(" S ")?this.stream=this.stream.substring(0,this.stream.length-3)+" B ":"S "==t&&this.stream.endsWith(" f ")?this.stream=this.stream.substring(0,this.stream.length-3)+" B ":this.stream+=t},PDFStream.prototype.replaceText=function(t,e){this.stream=this.stream.replace(t,e)},PDFStream.prototype.getObject=function(t){var e={Length:this.stream.length};return PDFObject.makeObject(e,this.id,this.stream)},PDFImage.prototype.writeImage=function(t){this.stream=t},PDFImage.prototype.getObject=function(){var t={Type:"XObject",Width:this.width,Height:this.height,Subtype:"Image",ColorSpace:"DeviceRGB",BitsPerComponent:8,Name:"Im"+this.id,Length:this.stream.length};return PDFObject.makeObject(t,this.id,this.stream)},PDFTextStyle.prototype.setFontName=function(t){this.fontName=t,this.font=void 0},PDFTextStyle.prototype.fontSetSize=function(t){this.fontSize=t},PDFTextStyle.prototype.setFontStyle=function(t,e){this.bold=t,this.italic=e},PDFTextStyle.prototype.setColor=function(t){this.color=t},PDFTextStyle.prototype.setAlpha=function(t){this.alpha=t},PDFTextStyle.prototype.getFontName=function(){return PDFFont.getPDFName(this.fontName,this.bold,this.italic)},PDFTextStyle.prototype.setFont=function(t){this.font=t},PDFTextStyle.prototype.clone=function(){var t=new PDFTextStyle;return t.fontName=this.fontName,t.fontSize=this.fontSize,t.bold=this.bold,t.italic=this.italic,t.color=this.color,t.alpha=this.alpha,t.font=this.font,t};var PDFObject,PDFReference;PDFObject=function(){function t(){}var e,i,o;return o=function(t,e){return(Array(e+1).join("0")+t).slice(-e)},i=/[\n\r\t\b\f\(\)\\]/g,e={"\n":"\\n","\r":"\\r","\t":"\\t","\b":"\\b","\f":"\\f","\\":"\\\\","(":"\\(",")":"\\)"},t.makeObject=function(e,i,o){var n=i+" 0 obj\n"+t.convert(e);return o&&(n+="\nstream\n"+o+"\nendstream\n"),n+="endobj\n"},t.convert=function(n){var r,s,a,h,c,p,f,d,l;if("string"==typeof n)return"/"+n;if(n instanceof String){for(a=!1,s=d=0,l=(p=n.replace(i,function(t){return e[t]})).length;d<l;s=d+=1)if(p.charCodeAt(s)>127){a=!0;break}if(a){var u="";for(s=d=0,l=p.length;d<l;s=d+=1)p.charCodeAt(s)<=127?u+=p[s]:u+="?";p=u}return"("+p+")"}if(n instanceof PDFReference)return n.toString();if(n instanceof Date)return"(D:"+o(n.getUTCFullYear(),4)+o(n.getUTCMonth()+1,2)+o(n.getUTCDate(),2)+o(n.getUTCHours(),2)+o(n.getUTCMinutes(),2)+o(n.getUTCSeconds(),2)+"Z)";if(Array.isArray(n))return"["+function(){var e,i,o;for(o=[],e=0,i=n.length;e<i;e++)r=n[e],o.push(t.convert(r));return o}().join(" ")+"]";if("[object Object]"==={}.toString.call(n)){c=["<<"];for(h in n)f=n[h],c.push("/"+h+" "+t.convert(f));return c.push(">>"),c.join("")+"\n"}return""+n},t}(),PDFReference=function(t){function e(t){this.str=t}return e.prototype.toString=function(){return this.str},e}();