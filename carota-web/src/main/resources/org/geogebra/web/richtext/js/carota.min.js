!function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=11)}([function(t,e){e.formattingKeys=["bold","italic","underline","strikeout","color","font","size","align","script"],e.defaultFormatting={size:10,font:"sans-serif",color:"black",bold:!1,italic:!1,underline:!1,strikeout:!1,align:"left",script:"normal"},e.sameFormatting=function(t,n){return e.formattingKeys.every((function(e){return t[e]===n[e]}))},e.clone=function(t){var n={text:t.text};return e.formattingKeys.forEach((function(r){var i=t[r];i&&i!=e.defaultFormatting[r]&&(n[r]=i)})),n},e.multipleValues={},e.merge=function(t,n){if(1===arguments.length)return Array.isArray(t)?t.reduce(e.merge):t;if(arguments.length>2)return e.merge(Array.prototype.slice.call(arguments,0));var r={};return e.formattingKeys.forEach((function(i){(i in t||i in n)&&(t[i]===n[i]?r[i]=t[i]:r[i]=e.multipleValues)})),r},e.format=function(t,n){Array.isArray(t)?t.forEach((function(t){e.format(t,n)})):Object.keys(n).forEach((function(r){n[r]!==e.multipleValues&&(t[r]=n[r])}))},e.consolidate=function(){var t;return function(n,r){t&&e.sameFormatting(t,r)&&"string"==typeof t.text&&"string"==typeof r.text?t.text+=r.text:n(t=e.clone(r))}},e.getPlainText=function(t){if("string"==typeof t.text)return t.text;if(Array.isArray(t.text)){var n=[];return t.text.forEach((function(t){n.push(e.getPiecePlainText(t))})),n.join("")}return"_"},e.getPieceLength=function(t){return t.length||1},e.getPiecePlainText=function(t){return t.length?t:"_"},e.getTextLength=function(t){if("string"==typeof t)return t.length;if(Array.isArray(t)){var n=0;return t.forEach((function(t){n+=e.getPieceLength(t)})),n}return 1},e.getSubText=function(t,n,r,i){if(0!==i)if("string"!=typeof n)if(Array.isArray(n)){var o=0;n.some((function(n){if(i<=0)return!0;var a=e.getPieceLength(n);if(o+a>r)if(1===a)t(n),i-=1;else{var s=n.substr(Math.max(0,r-o),i);t(s),i-=s.length}o+=a}))}else t(n);else t(n.substr(r,i))},e.getTextChar=function(t,n){var r;return e.getSubText((function(t){r=t}),t,n,1),r},e.pieceCharacters=function(t,e){if("string"==typeof e)for(var n=0;n<e.length;n++)t(e[n]);else t(e)}},function(t,e){var n={contains:function(t,e){return t>=this.l&&t<this.l+this.w&&e>=this.t&&e<this.t+this.h},stroke:function(t){t.strokeRect(this.l,this.t,this.w,this.h)},fill:function(t){t.fillRect(this.l,this.t,this.w,this.h)},offset:function(t,e){return r(this.l+t,this.t+e,this.w,this.h)},equals:function(t){return this.l===t.l&&this.t===t.t&&this.w===t.w&&this.h===t.h},center:function(){return{x:this.l+this.w/2,y:this.t+this.h/2}}},r=t.exports=function(t,e,r,i){return Object.create(n,{l:{value:t},t:{value:e},w:{value:r},h:{value:i},r:{value:t+r},b:{value:e+i}})}},function(t,e,n){n(3),n(0);var r=n(1),i=n(5);e.prototype={children:function(){return[]},parent:function(){return null},first:function(){return this.children()[0]},last:function(){return this.children()[this.children().length-1]},next:function(){for(var t=this;;){var e=t.parent();if(!e)return null;var n=e.children(),r=n[n.indexOf(t)+1];if(r){for(;;){var i=r.first();if(!i)break;r=i}return r}t=e}},previous:function(){var t=this.parent();if(!t)return null;var e=t.children(),n=e[e.indexOf(this)-1];if(n)return n;var r=t.previous();return r?r.last():null},byOrdinal:function(t){var e=null;return this.children().some((function(n){if(t>=n.ordinal&&t<n.ordinal+n.length&&(e=n.byOrdinal(t)))return!0}))?e:this},byCoordinate:function(t,e){var n;if(this.children().some((function(r){if(r.bounds().contains(t,e)&&(n=r.byCoordinate(t,e)))return!0})),!n){for(n=this.last();n;){var r=n.last();if(!r)break;n=r}var i=n.next();i&&i.block&&(n=i)}return n},draw:function(t,e){this.children().forEach((function(n){n.draw(t,e)}))},parentOfType:function(t){var e=this.parent();return e&&(e.type===t?e:e.parentOfType(t))},bounds:function(){var t=this._left,e=this._top,n=0,i=0;return this.children().forEach((function(r){var o=r.bounds();t=Math.min(t,o.l),e=Math.min(e,o.t),n=Math.max(n,o.l+o.w),i=Math.max(i,o.t+o.h)})),r(t,e,n-t,i-e)}},e.derive=function(t){return i.derive(e.prototype,t)};var o=e.derive({children:function(){return this._children},parent:function(){return this._parent},finalize:function(t,e){var n=Number.MAX_VALUE,r=0;this._children.forEach((function(t){n=Math.min(n,t.ordinal),r=Math.max(r,t.ordinal+t.length)})),Object.defineProperty(this,"ordinal",{value:n-(t||0)}),Object.defineProperty(this,"length",{value:(e||0)+r-n})}});e.generic=function(t,e,n,r){return Object.create(o,{type:{value:t},_children:{value:[]},_parent:{value:e},_left:{value:"number"==typeof n?n:Number.MAX_VALUE},_top:{value:"number"==typeof r?r:Number.MAX_VALUE}})}},function(t,e,n){!function(e){function n(t,e){return"function"!=typeof t?Array.isArray(t)?function(e){return t.some(e)}:function(e){return e(t)}:e?function(n,r){t.call(e,n,r)}:t}function r(t,e){this.forEach=n(t,e)}function i(t,e){t(e)}function o(t,e){return 0===arguments.length?new r(i):t&&t instanceof r?t:new r(t,e)}function a(t){return"string"==typeof t?new Function("x","return "+t):t}function s(t,e){var n=t[e];return"function"==typeof n?n:function(n){t[e]=n}}function u(){}function c(t){return!!t}function l(t,e){return Math.min(t,e)}function f(t,e){return Math.max(t,e)}function h(t,e){return t+e}function d(t,e){return!(!t||!e)}function p(t,e){return!(!t&&!e)}function v(t){return!t}var g;r.prototype.per=function(t,e){var r=this.forEach,i=n(t&&t.forEach||t,e);return o((function(t,e){return r((function(e){return i(t,e)}),e)}))},r.prototype.map=function(t){return t=a(t),this.per((function(e,n){return e(t(n))}))},r.prototype.filter=function(t){return t=a(t),this.per((function(e,n){if(t(n))return e(n)}))},r.prototype.concat=function(t,e){t=t instanceof r?t.forEach:n(t,e);var i=this.forEach;return o((function(e,n){i(e,n),t(e,n)}))},r.prototype.skip=function(t){return this.per((function(e,n){return t>0?(t--,!1):e(n)}))},r.prototype.take=function(t){return this.per((function(e,n){return t<=0||(t--,e(n))}))},r.prototype.listen=function(t){return this.per((function(e,n){return!!t(n)||e(n)}))},r.prototype.flatten=function(){return this.per((function(t,e){return Array.isArray(e)?e.some((function(e){return t(e)})):t(e)}))},r.prototype.reduce=function(t,e){var n=e,r=2==arguments.length;return this.per((function(e,i){e(n=r?t(n,i):i),r=!0}))},r.prototype.multicast=function(t){return 1!==arguments.length&&(t=Array.prototype.slice.call(arguments,0)),t=t.map((function(t){return"function"==typeof t?t:t instanceof r?t.forEach:u})),this.listen((function(e){var n=!0;return t.forEach((function(t){t(u,e)||(n=!1)})),n}))},r.prototype.into=function(t,e){if(!Array.isArray(t))throw new Error("into expects an array");return e=function(t){return"number"!=typeof t?Number.MAX_VALUE:t}(e),this.listen((function(n){if(e<=0)return!0;t.push(n),e--}))},r.prototype.monitor=function(t){var e=0,n=s(t,"count"),r=s(t,"first"),i=s(t,"last"),o=t.limit;return"number"!=typeof o&&(o=Number.MAX_VALUE),o<1?this:this.listen((function(t){if(0===e&&r(t),e++,n(e),i(t),e>=o)return!0}))},r.prototype.submit=function(t){return this.forEach(u,t)},r.prototype.all=function(){var t=[];return this.into(t).submit(),t},r.prototype.first=function(){var t={limit:1};return this.monitor(t).submit(),t.count>0?t.first:void 0},r.prototype.last=function(){var t={};return this.monitor(t).submit(),t.count>0?t.last:void 0},r.prototype.truthy=function(){return this.filter(c)},r.prototype.min=function(){return this.reduce(l,Number.MAX_VALUE)},r.prototype.max=function(){return this.reduce(f,Number.MIN_VALUE)},r.prototype.sum=function(){return this.reduce(h,0)},r.prototype.and=function(){return this.reduce(d,!0)},r.prototype.or=function(){return this.reduce(p,!1)},r.prototype.not=function(){return this.map(v)},o.pulse=function(t){var e=0;return o((function(n){!function r(){!0!==n(e++)&&setTimeout(r,t)}()}))},g=o,t.exports=g}()},function(t,e,n){var r=n(0),i=e.getFontString=function(t){var e=t&&t.size||r.defaultFormatting.size;if(t)switch(t.script){case"super":case"sub":e*=.8}return(t&&t.italic?"italic ":"")+(t&&t.bold?"bold ":"")+" "+e+"pt "+(t&&t.font||r.defaultFormatting.font)};e.applyRunStyle=function(t,e){t.fillStyle=e&&e.color||r.defaultFormatting.color,t.font=i(e)},e.prepareContext=function(t){t.textAlign="left",t.textBaseline="alphabetic"},e.getRunStyle=function(t){var e=["font: ",i(t),"; color: ",t&&t.color||r.defaultFormatting.color];if(t)switch(t.script){case"super":e.push("; vertical-align: super");break;case"sub":e.push("; vertical-align: sub")}return e.join("")};var o=e.nbsp=String.fromCharCode(160),a=(e.enter=o,e.measureText=function(t,e){var n,r,i;n=document.createElement("span"),r=document.createElement("div"),i=document.createElement("div"),r.style.display="inline-block",r.style.width="1px",r.style.height="0",i.style.visibility="hidden",i.style.position="absolute",i.style.top="0",i.style.left="0",i.style.width="500px",i.style.height="200px",i.appendChild(n),i.appendChild(r),document.body.appendChild(i);try{n.setAttribute("style",e),n.innerHTML="",n.appendChild(document.createTextNode(t.replace(/\s/g,o)));var a={};r.style.verticalAlign="baseline",a.ascent=r.offsetTop-n.offsetTop,r.style.verticalAlign="bottom",a.height=r.offsetTop-n.offsetTop,a.descent=a.height-a.ascent,a.width=n.offsetWidth}finally{i.parentNode.removeChild(i),i=null}return a}),s=e.createCachedMeasureText=function(){var t={};return function(e,n){var r=n+"<>!&%"+e,i=t[r];return i||(t[r]=i=a(e,n)),i}};e.cachedMeasureText=s(),e.measure=function(t,n){return e.cachedMeasureText(t,e.getRunStyle(n))},e.draw=function(t,n,r,i,o,a,s,u){switch(e.prepareContext(t),e.applyRunStyle(t,r),r.script){case"super":o-=s*(1/3);break;case"sub":o+=u/2}t.fillText("\n"===n?e.enter:n,i,o),r.underline&&t.fillRect(i,1+o,a,1),r.strikeout&&t.fillRect(i,1+o-s/2,a,1)}},function(t,e){e.event=function(){var t=[],e=function(e){t.push(e)};return e.fire=function(){var e=Array.prototype.slice.call(arguments,0);t.forEach((function(t){t.apply(null,e)}))},e},e.derive=function(t,e){var n={};return Object.keys(e).forEach((function(t){n[t]={value:e[t]}})),Object.create(t,n)}},function(t,e,n){var r=n(2),i=n(16),o=n(1),a=r.derive({bounds:function(){if(!this._bounds){var t=0,e=0,n=0,r=0;if(this.lines.length){var i=this.lines[0].bounds();t=i.l,e=i.t,this.lines.forEach((function(t){var e=t.bounds();n=Math.max(n,e.l+e.w),r=Math.max(r,e.t+e.h)}))}this._bounds=o(t,e,n-t,this.height||r-e)}return this._bounds},actualWidth:function(){if(!this._actualWidth){var t=0;this.lines.forEach((function(e){"number"==typeof e.actualWidth&&(t=Math.max(t,e.actualWidth))})),this._actualWidth=t}return this._actualWidth},children:function(){return this.lines},parent:function(){return this._parent},draw:function(t,e){var n=e?e.t:0,r=e?e.t+e.h:Number.MAX_VALUE;this.lines.some((function(i){var o=i.bounds();return!(o.t+o.h<n)&&(o.t>r||void i.draw(t,e))}))},type:"frame"});t.exports=function(t,e,n,r,o,s,u,c){var l=[],f=Object.create(a,{lines:{value:l},_parent:{value:o},ordinal:{value:r}}),h=i(t,e,n,r,f,s,u,c),d=0,p=0;return function(t,e){if(h((function(t){"number"==typeof t?p=t:(d=t.ordinal+t.length-r,l.push(t))}),e))return Object.defineProperty(f,"length",{value:d}),Object.defineProperty(f,"height",{value:p}),t(f),!0}}},function(t,e,n){var r=n(3),i=n(13),o=n(14),a=n(8),s=n(2),u=n(0),c=n(15),l=n(5),f=n(6),h=n(19),d=n(1),p=function(t,e,n,r){var i=t.selection.start,o=t.selection.end;return function(a){t._wordOrdinals=[];var s=Array.prototype.splice.apply(t.words,[e,n].concat(r));a(p(t,e,r.length,s)),t._nextSelection={start:i,end:o}}},v=function(t){var e=[],n=function(t){e.push(t),n.length=e.length};return t(n),function(t){t(v((function(t){for(;e.length;)e.pop()(t)})))}},g=function(t){if(t.isNewLine())return!0;var e=t.code();return!(!e||!e.block&&!e.eof)},m=s.derive({load:function(t,e){var n=this;this.undo=[],this.redo=[],this._wordOrdinals=[],this.words=r(i(t)).per(o(n.codes)).map((function(t){return a(t,n.codes)})).all(),this.layout(),this.contentChanged.fire(),this.select(0,0,e)},layout:function(){this.frame=null;try{this.frame=r(this.words).per(f(0,0,this._width,0,this)).first()}catch(t){console.error(t)}if(this.frame){if(this._nextSelection){var t=this._nextSelection;delete this._nextSelection,this.select(t.start,t.end)}}else console.error("A bug somewhere has produced an invalid state - rolling back"),this.performUndo()},range:function(t,e){return c(this,t,e)},documentRange:function(){return this.range(0,this.frame.length-1)},selectedRange:function(){return this.range(this.selection.start,this.selection.end)},save:function(){return this.documentRange().save()},paragraphRange:function(t,e){var n,r=this.wordContainingOrdinal(t);if(t=0,r&&!g(r.word))for(n=r.index;n>0;n--)if(g(this.words[n-1])){t=this.wordOrdinal(n);break}var i=this.wordContainingOrdinal(e);if(e=this.frame.length-1,i&&!g(i.word))for(n=i.index;n<this.words.length;n++)if(g(this.words[n])){e=this.wordOrdinal(n);break}return this.range(t,e)},insert:function(t,e){this.select(this.selection.end+this.selectedRange().setText(t),null,e)},modifyInsertFormatting:function(t,e){this.nextInsertFormatting[t]=e,this.notifySelectionChanged()},applyInsertFormatting:function(t){var e=this.nextInsertFormatting,n=Object.keys(e);n.length&&t.forEach((function(t){n.forEach((function(n){t[n]=e[n]}))}))},wordOrdinal:function(t){if(t<this.words.length){var e=this._wordOrdinals.length;if(e<t+1)for(var n=e>0?this._wordOrdinals[e-1]:0,r=e;r<=t;r++)this._wordOrdinals[r]=n,n+=this.words[r].length;return this._wordOrdinals[t]}},wordContainingOrdinal:function(t){var e,n=0;return this.words.some((function(r,i){if(t>=n&&t<n+r.length)return e={word:r,ordinal:n,index:i,offset:t-n},!0;n+=r.length})),e},runs:function(t,e){var n=this.wordContainingOrdinal(Math.max(0,e.start)),r=this.wordContainingOrdinal(Math.min(e.end,this.frame.length-1));if(n.index===r.index)n.word.runs(t,{start:n.offset,end:r.offset});else{n.word.runs(t,{start:n.offset});for(var i=n.index+1;i<r.index;i++)this.words[i].runs(t);r.word.runs(t,{end:r.offset})}},spliceWordsWithRuns:function(t,e,n){var s=this,u=r(i(n)).per(o(s.codes)).truthy().map((function(t){return a(t,s.codes)})).all(),c=!1;if("_filtersRunning"in s)s._filtersRunning++;else{for(var l=0;l<e;l++)this.words[t+l].code()&&(c=!0);c||(c=u.some((function(t){return!!t.code()})))}this.transaction((function(n){if(p(s,t,e,u)(n),c){s._filtersRunning=0;try{for(;;){var r=s._filtersRunning;if(!s.editFilters.some((function(t){return t(s),r!==s._filtersRunning})))break}}finally{delete s._filtersRunning}}}))},splice:function(t,e,n){if("string"==typeof n){var i=Math.max(0,t-1),o=r({start:i,end:i+1}).per(this.runs,this).first();n=[o?Object.create(o,{text:{value:n}}):{text:n}]}else Array.isArray(n)||(n=[{text:n}]);this.applyInsertFormatting(n);var a,s,c=this.wordContainingOrdinal(t),l=this.wordContainingOrdinal(e);if(t===c.ordinal)if(c.index>0&&!g(this.words[c.index-1])){c.index--;var f=this.words[c.index];a=r({}).per(f.runs,f).all()}else a=[];else a=r({end:c.offset}).per(c.word.runs,c.word).all();e===l.ordinal?e===this.frame.length-1||g(l.word)?(s=[],l.index--):s=r({}).per(l.word.runs,l.word).all():s=r({start:l.offset}).per(l.word.runs,l.word).all();var h=this.frame.length;return this.spliceWordsWithRuns(c.index,l.index-c.index+1,r(a).concat(n).concat(s).per(u.consolidate()).all()),this.frame?this.frame.length-h:0},registerEditFilter:function(t){this.editFilters.push(t)},width:function(t){if(0===arguments.length)return this._width;this._width=t,this.layout()},children:function(){return[this.frame]},toggleCaret:function(){var t=this.caretVisible;return this.selection.start===this.selection.end&&(this.selectionJustChanged?this.selectionJustChanged=!1:this.caretVisible=!this.caretVisible),this.caretVisible!==t},getCaretCoords:function(t){var e,n=this.byOrdinal(t);if(n){if(n.block&&t>0){var r=this.byOrdinal(t-1);if(r.newLine){var i=r.bounds(),o=r.parent().parent().bounds();e=d(o.l,o.b,1,i.h)}else e=r.bounds(),e=d(e.r,e.t,1,e.h)}else e=(e=n.bounds()).h?d(e.l,e.t,1,e.h):d(e.l,e.t,e.w,1);return e}},byCoordinate:function(t,e){for(var n=this.frame.byCoordinate(t,e).ordinal,r=this.getCaretCoords(n);r.b<=e&&n<this.frame.length-1;)n++,r=this.getCaretCoords(n);for(;r.t>=e&&n>0;)n--,r=this.getCaretCoords(n);return this.byOrdinal(n)},drawSelection:function(t,e){if(this.selection.end===this.selection.start){if(this.selectionJustChanged||e&&this.caretVisible){var n=this.getCaretCoords(this.selection.start);n&&(t.save(),t.fillStyle="black",n.fill(t),t.restore())}}else t.save(),t.fillStyle=e?"rgba(0, 100, 200, 0.3)":"rgba(160, 160, 160, 0.3)",this.selectedRange().parts((function(e){e.bounds(!0).fill(t)})),t.restore()},notifySelectionChanged:function(t){var e=null,n=this;this.selectionChanged.fire((function(){return e||(e=n.selectedRange().getFormatting()),e}),t)},select:function(t,e,n){this.frame&&(this.selection.start=Math.max(0,t),this.selection.end=Math.min("number"==typeof e?e:this.selection.start,this.frame.length-1),this.selectionJustChanged=!0,this.caretVisible=!0,this.nextInsertFormatting={},this.notifySelectionChanged(n))},performUndo:function(t){var e=t?this.redo:this.undo,n=t?this.undo:this.redo,r=e.pop();r&&(r((function(t){n.push(t)})),this.layout(),this.contentChanged.fire())},canUndo:function(t){return t?!!this.redo.length:!!this.undo.length},transaction:function(t){if(this._currentTransaction)t(this._currentTransaction);else{for(var e=this;this.undo.length>50;)e.undo.shift();this.redo.length=0;var n=!1;this.undo.push(v((function(r){e._currentTransaction=r;try{t(r)}finally{n=r.length>0,e._currentTransaction=null}}))),n&&(e.layout(),e.contentChanged.fire())}},type:"document"});t.exports=function(){var t=Object.create(m);return t._width=0,t.selection={start:0,end:0},t.caretVisible=!0,t.customCodes=function(t,e,n){},t.codes=function(e,n){return h(e,n,t.codes)||t.customCodes(e,n,t.codes)},t.selectionChanged=l.event(),t.contentChanged=l.event(),t.editFilters=[h.editFilter],t.load([]),t}},function(t,e,n){var r=n(3),i=n(9),o=n(0),a={isNewLine:function(){return 1==this.text.parts.length&&this.text.parts[0].isNewLine},code:function(){return 1==this.text.parts.length&&this.text.parts[0].code},codeFormatting:function(){return 1==this.text.parts.length&&this.text.parts[0].run},draw:function(t,e,n){r(this.text.parts).concat(this.space.parts).forEach((function(r){r.draw(t,e,n),e+=r.width}))},plainText:function(){return this.text.plainText+this.space.plainText},align:function(){var t=this.text.parts[0];return t?t.run.align:"left"},runs:function(t,e){var n=e&&e.start||0,r=e&&e.end;"number"!=typeof r&&(r=Number.MAX_VALUE),[this.text,this.space].forEach((function(e){e.parts.some((function(e){if(n>=r||r<=0)return!0;var i=e.run,o=i.text;if("string"==typeof o){if(n<=0&&r>=o.length)t(i);else if(n<o.length){var a=Object.create(i),s=Math.max(0,n);a.text=o.substr(s,Math.min(o.length,r-s)),t(a)}n-=o.length,r-=o.length}else n<=0&&r>=1&&t(i),n--,r--}))}))}},s=function(t,e){var n={parts:r(t).map((function(t){return i(t,e)})).all(),ascent:0,descent:0,width:0,length:0,plainText:""};return n.parts.forEach((function(t){n.ascent=Math.max(n.ascent,t.ascent),n.descent=Math.max(n.descent,t.descent),n.width+=t.width,n.length+=o.getPieceLength(t.run.text),n.plainText+=o.getPiecePlainText(t.run.text)})),n};t.exports=function(t,e){var n,r;t?(n=t.text.cut(t.spaces),r=t.spaces.cut(t.end)):(n=[{text:"\n"}],r=[]),n=s(n,e),r=s(r,e);var i=Object.create(a,{text:{value:n},space:{value:r},ascent:{value:Math.max(n.ascent,r.ascent)},descent:{value:Math.max(n.descent,r.descent)},width:{value:n.width+r.width,configurable:!0},length:{value:n.length+r.length}});return t||Object.defineProperty(i,"eof",{value:!0}),i}},function(t,e,n){var r=n(4),i={measure:function(t){var e=e.measure("?",t);return{width:e.width+4,ascent:e.width+2,descent:e.width+2}},draw:function(t,e,n,r,i,o){t.fillStyle="silver",t.fillRect(e,n-i,r,i+o),t.strokeRect(e,n-i,r,i+o),t.fillStyle="black",t.fillText("?",e+2,n)}},o={draw:function(t,e,n){"string"==typeof this.run.text?r.draw(t,this.run.text,this.run,e,n,this.width,this.ascent,this.descent):this.code&&this.code.draw&&(t.save(),this.code.draw(t,e,n,this.width,this.ascent,this.descent,this.run),t.restore())}};t.exports=function(t,e){var n,a,s;"string"==typeof t.text?(a=1===t.text.length&&"\n"===t.text[0],n=r.measure(a?r.nbsp:t.text,t)):n=(s=e(t.text)||i).measure?s.measure(t):{width:0,ascent:0,descent:0};var u=Object.create(o,{run:{value:t},isNewLine:{value:a},width:{value:a?0:n.width},ascent:{value:n.ascent},descent:{value:n.descent}});return s&&Object.defineProperty(u,"code",{value:s}),u}},function(t,e){e.isAttached=function(t){for(var e=t;e.parentNode;)e=e.parentNode;return!!e.body},e.clear=function(t){for(;t.firstChild;)t.removeChild(t.firstChild)},e.setText=function(t,n){e.clear(t),t.appendChild(document.createTextNode(n))},e.handleEvent=function(t,e,n){t.addEventListener(e,(function(t){!1===n(t)&&t.preventDefault()}))},e.handleMouseEvent=function(t,n,r){e.handleEvent(t,n,(function(e){var n=t.getBoundingClientRect();return r(e,e.clientX-n.left,e.clientY-n.top)}))},e.effectiveStyle=function(t,e){return document.defaultView.getComputedStyle(t).getPropertyValue(e)}},function(t,e,n){var r={node:n(2),editor:n(12),document:n(7),dom:n(10),runs:n(0),html:n(20),frame:n(6),text:n(4),rect:n(1)};if(t.exports=r,"undefined"!=typeof window&&window.document){if(window.carota)throw new Error("Something else is called carota!");window.carota=r}},function(t,e,n){n(3);var r=n(7),i=n(10),o=n(1);setInterval((function(){var t=document.querySelectorAll(".carotaEditorCanvas"),e=document.createEvent("Event");e.initEvent("carotaEditorSharedTimer",!0,!0);for(var n=0;n<t.length;n++)t[n].dispatchEvent(e)}),200),e.create=function(t){"absolute"!==i.effectiveStyle(t,"position")&&(t.style.position="relative"),t.innerHTML='<div class="carotaSpacer"><canvas width="100" height="100" class="carotaEditorCanvas" style="position: absolute;"></canvas></div><div class="carotaTextArea" style="overflow: hidden; position: absolute; height: 0;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none; font-size: 4px;"></textarea>';var e=t.querySelector("canvas"),n=t.querySelector(".carotaSpacer"),a=t.querySelector(".carotaTextArea"),s=t.querySelector("textarea"),u=r(),c=0,l=null,f=null,h=null,d=null,p="",v=null,g=null,m={66:"bold",73:"italic",85:"underline",83:"strikeout"},y=function(t,e){return e<0?t<=0:t>=u.frame.length-1},b=function(t,e){return t.b<=e.t||e.b<=t.t},w=function(t,e){var n,r=u.getCaretCoords(t);for(f=null!==l?l:r.l;!y(t,e)&&(t+=e,n=u.getCaretCoords(t),!b(n,r)););for(r=n;!y(t,e)&&!(e>0&&n.l>=f||e<0&&n.l<=f);)if(t+=e,n=u.getCaretCoords(t),b(n,r)){t-=e;break}return t},x=function(t,e){for(var n,r=u.getCaretCoords(t);!y(t,e);)if(t+=e,n=u.getCaretCoords(t),b(n,r)){t-=e;break}return t},_=function(t,e,n){var r=u.selection.start,i=u.selection.end,o=u.frame.length-1,a=!1;if(f=null,e){if(!c)switch(t){case 37:case 38:case 36:case 33:c=-1;break;case 39:case 40:case 35:case 34:c=1}}else c=0;var s=1===c?i:r,h=!1;switch(t){case 37:if(e||r==i){if(s>0)if(n)s=(p=u.wordContainingOrdinal(s)).ordinal===s?p.index>0?u.wordOrdinal(p.index-1):0:p.ordinal;else s--}else s=r;h=!0;break;case 39:var p;if(e||r==i){if(s<o)if(n)s=(p=u.wordContainingOrdinal(s)).ordinal+p.word.length;else s++}else s=i;h=!0;break;case 40:s=w(s,1),h=!0;break;case 38:s=w(s,-1),h=!0;break;case 36:s=x(s,-1),h=!0;break;case 35:s=x(s,1),h=!0;break;case 33:s=0,h=!0;break;case 34:s=o,h=!0;break;case 8:r===i&&r>0&&(u.range(r-1,r).clear(),d=r-1,u.select(d,d),a=!0);break;case 46:r===i&&r<o&&(u.range(r,r+1).clear(),a=!0);break;case 90:n&&(a=!0,u.performUndo());break;case 89:n&&(a=!0,u.performUndo(!0));break;case 65:n&&(a=!0,u.select(0,o));break;case 67:case 88:n&&(v=u.selectedRange().save(),g=u.selectedRange().plainText())}var y=m[t];if(n&&y){var b=u.selectedRange();b.setFormatting(y,!0!==b.getFormatting()[y]),O(),a=!0}if(h){switch(c){case 0:r=i=s;break;case-1:r=s;break;case 1:i=s}if(r===i)c=0;else if(r>i){c=-c;var _=i;i=r,r=_}d=s,u.select(r,i),a=!0}return l=f,a};i.handleEvent(s,"keydown",(function(t){if(_(t.keyCode,t.shiftKey,t.ctrlKey))return!1;console.log(t.which)}));var C="top";function E(){var e=u.frame.bounds().h;if(e<t.clientHeight)switch(C){case"middle":return(t.clientHeight-e)/2;case"bottom":return t.clientHeight-e}return 0}u.setVerticalAlignment=function(t){C=t,O()};var O=function(){var r=1*t.clientWidth;u.width()!==r&&u.width(r);var i=u.frame.bounds().h,a=Math.max(1,window.devicePixelRatio||1),c=Math.max(u.frame.actualWidth(),t.clientWidth),l=t.clientHeight;e.width=a*c,e.height=a*l,e.style.width=c+"px",e.style.height=l+"px",e.style.top=t.scrollTop+"px",n.style.width=c+"px",n.style.height=Math.max(i,t.clientHeight)+"px",i<t.clientHeight-50&&u.frame.actualWidth()<=r?t.style.overflow="hidden":t.style.overflow="auto";var f=e.getContext("2d");f.scale(a,a),f.clearRect(0,0,c,l),f.translate(0,E()-t.scrollTop),u.draw(f,o(0,t.scrollTop,c,l)),u.drawSelection(f,h||document.activeElement===s)};i.handleEvent(t,"scroll",O),i.handleEvent(s,"input",(function(){var t=s.value;p!=t&&(p="",s.value="",t===g&&(t=v),u.insert(t))}));var k=function(){d=null===d?u.selection.end:d;var e=u.byOrdinal(d);if(d=null,e){var n=e.bounds();a.style.left=n.l+"px",a.style.top=n.t+"px",s.focus();var r=Math.max(0,n.t+n.h-(t.scrollTop+t.clientHeight));r&&(t.scrollTop+=r);var i=Math.max(0,t.scrollTop-n.t);i&&(t.scrollTop-=i);var o=Math.max(0,n.l-(t.scrollLeft+t.clientWidth));o&&(t.scrollLeft+=o);var c=Math.max(0,t.scrollLeft-n.l);c&&(t.scrollLeft-=c)}p=u.selectedRange().plainText(),s.value=p,s.select(),setTimeout((function(){s.focus()}),10)};function T(t,e){i.handleMouseEvent(n,t,(function(t,n,r){e(u.byCoordinate(n,r-E()))}))}u.selectionChanged((function(t,e){O(),h||!1!==e&&k()})),T("mousedown",(function(t){h=t.ordinal,u.select(t.ordinal,t.ordinal),l=null})),T("dblclick",(function(t){(t=t.parent())&&u.select(t.ordinal,t.ordinal+(t.word?t.word.text.length:t.length))})),T("mousemove",(function(t){null!==h&&t&&(d=t.ordinal,h>t.ordinal?u.select(t.ordinal,h):u.select(h,t.ordinal))})),T("mouseup",(function(t){h=null,l=null,k(),s.focus()}));var M=(new Date).getTime(),S=!1,A=t.clientWidth,j=t.clientHeight,R=function(){var e=!1,n=document.activeElement===s;S!==n&&(S=n,e=!0);var r=(new Date).getTime();r>M&&(M=r+500,u.toggleCaret()&&(e=!0)),t.clientWidth===A&&t.clientHeight===j||(e=!0,A=t.clientWidth,j=t.clientHeight),e&&O()};return i.handleEvent(e,"carotaEditorSharedTimer",R),R(),u.sendKey=_,u}},function(t,e,n){var r=n(0),i=function(t,e){if(t._runs!==e._runs)throw new Error("Characters for different documents")},o={equals:function(t){return i(this,t),this._run===t._run&&this._offset===t._offset},cut:function(t){i(this,t);var e=this;return function(n){for(var i=e._run;i<=t._run;i++){var o=e._runs[i];if(o){var a=i===e._run?e._offset:0,s=i===t._run?t._offset:r.getTextLength(o.text);a<s&&r.getSubText((function(t){var e=Object.create(o);e.text=t,n(e)}),o.text,a,s-a)}}}}};function a(t,e,n){return Object.create(o,{_runs:{value:t},_run:{value:e},_offset:{value:n},char:{value:e>=t.length?null:r.getTextChar(t[e].text,n)}})}function s(t,e){for(;e<t.length;e++)if(0!=r.getTextLength(t[e].text))return a(t,e,0);return a(t,t.length,0)}t.exports=function(t){return function(e){for(var n=s(t,0);!e(n)&&null!==n.char;)n=n._offset+1<r.getTextLength(t[n._run].text)?a(t,n._run,n._offset+1):s(t,n._run+1)}}},function(t,e){t.exports=function(t){var e=null,n=null,r=!0;return function(i,o){var a;if(null===o.char)a=!0;else if(r&&(a=!0,r=!1),"string"==typeof o.char)switch(o.char){case" ":n||(n=o);break;case"\n":a=!0,r=!0;break;default:n&&(a=!0)}else{var s=t(o.char);(s.block||s.eof)&&(a=!0,r=!0)}if(a){if(e&&!e.equals(o)){if(!1===i({text:e,spaces:n||o,end:o}))return!1;n=null}null===o.char&&i(null),e=o}}}},function(t,e,n){var r=n(3),i=n(0);function o(t,e,n){this.doc=t,this.start=e,this.end=n,e>n&&(this.start=n,this.end=e)}o.prototype.parts=function(t,e){e=e||this.doc.children();var n=this;e.some((function(e){return!(e.ordinal+e.length<=n.start)&&(e.ordinal>=n.end||void(e.ordinal>=n.start&&e.ordinal+e.length<=n.end?t(e):n.parts(t,e.children())))}))},o.prototype.clear=function(){return this.setText([])},o.prototype.setText=function(t){return this.doc.splice(this.start,this.end,t)},o.prototype.runs=function(t){this.doc.runs(t,this)},o.prototype.plainText=function(){return r(this.runs,this).map(i.getPlainText).all().join("")},o.prototype.save=function(){return r(this.runs,this).per(i.consolidate()).all()},o.prototype.getFormatting=function(){if(this.start===this.end){var t=this.start;t>0&&t--,this.start=t,this.end=t+1}return r(this.runs,this).reduce(i.merge).last()||i.defaultFormatting},o.prototype.setFormatting=function(t,e){var n=this;if("align"===t&&(n=n.doc.paragraphRange(n.start,n.end)),n.start===n.end)n.doc.modifyInsertFormatting(t,e);else{var r=n.save(),o={};o[t]=e,i.format(r,o),n.setText(r)}},t.exports=function(t,e,n){return new o(t,e,n)}},function(t,e,n){var r=n(17);t.exports=function(t,e,n,i,o,a,s,u){var c,l=[],f=0,h=s||0,d=u||0,p=0,v=e,g=function(t,e){l.push(t),f+=t.width,h=Math.max(h,t.ascent),d=Math.max(d,t.descent),t.isNewLine()&&(m(e),p=t.ascent+t.descent)},m=function(e){if(!c&&0!==l.length){var a=r(o,t,n,v+h,h,d,l,i);i+=a.length,c=e(a),v+=h+d,l.length=0,f=h=d=0}},y=null;return function(r,s){if(y){p=0;var u=y(s);u&&(y=null,i+=u.length,v+=u.bounds().h,Object.defineProperty(u,"block",{value:!0}),r(u))}else{var h=s.code();h&&h.block?(l.length?m(r):v+=p,y=h.block(t,v,n,i,o,s.codeFormatting()),p=0):h&&h.eof||s.eof?((!h||a&&a(h))&&g(s,r),l.length?(m(r),r(v-e)):r(v+p-e),c=!0):(p=0,l.length?(f+s.text.width>n&&m(r),g(s,r)):g(s,r))}return c}}},function(t,e,n){var r=n(18),i=n(1),o=n(2),a=(n(0),o.derive({bounds:function(t){if(t){var e=this.first().bounds(),n=this.last().bounds();return i(e.l,this.baseline-this.ascent,n.l+n.w-e.l,this.ascent+this.descent)}return i(this.left,this.baseline-this.ascent,this.width,this.ascent+this.descent)},parent:function(){return this.doc},children:function(){return this.positionedWords},type:"line"}));t.exports=function(t,e,n,i,o,s,u,c){var l=u[0].align(),f=Object.create(a,{doc:{value:t},left:{value:e},width:{value:n},baseline:{value:i},ascent:{value:o},descent:{value:s},ordinal:{value:c},align:{value:l}}),h=0;u.forEach((function(t){h+=t.width})),h-=u[u.length-1].space.width;var d=0,p=0;if(h<n)switch(l){case"right":d=n-h;break;case"center":d=(n-h)/2;break;case"justify":u.length>1&&!u[u.length-1].isNewLine()&&(p=(n-h)/(u.length-1))}return Object.defineProperty(f,"positionedWords",{value:u.map((function(t){var e=d;d+=t.width+p;var n=c;return c+=t.text.length+t.space.length,r(t,f,e,n,t.width+p)}))}),Object.defineProperty(f,"actualWidth",{value:h}),Object.defineProperty(f,"length",{value:c-f.ordinal}),f}},function(t,e,n){var r=n(1),i=n(9),o=n(4),a=n(2),s=(n(8),n(0)),u=function(t){return o.measure(o.enter,t).width},c=a.derive({bounds:function(){var t=this.word.bounds(),e=this.word.word.isNewLine()?u(this.word.word.run):this.width||this.part.width;return r(t.l+this.left,t.t,e,t.h)},parent:function(){return this.word},byOrdinal:function(){return this},byCoordinate:function(t,e){return t<=this.bounds().center().x?this:this.next()},type:"character"}),l=a.derive({draw:function(t){this.word.draw(t,this.line.left+this.left,this.line.baseline)},bounds:function(){return r(this.line.left+this.left,this.line.baseline-this.line.ascent,this.word.isNewLine()?u(this.word.run):this.width,this.line.ascent+this.line.descent)},parts:function(t){this.word.text.parts.some(t)||this.word.space.parts.some(t)},realiseCharacters:function(){if(!this._characters){var t=[],e=0,n=this,r=this.ordinal,o=this.parentOfType("document").codes;this.parts((function(a){s.pieceCharacters((function(s){var u=Object.create(a.run);u.text=s;var l=i(u,o);t.push(Object.create(c,{left:{value:e},part:{value:l},word:{value:n},ordinal:{value:r},length:{value:1}})),e+=l.width,r++}),a.run.text)}));var a=t[t.length-1];a&&(Object.defineProperty(a,"width",{value:this.width-a.left}),(this.word.isNewLine()||this.word.code()&&this.word.code().eof)&&Object.defineProperty(a,"newLine",{value:!0})),this._characters=t}},children:function(){return this.realiseCharacters(),this._characters},parent:function(){return this.line},type:"word"});t.exports=function(t,e,n,r,i){return Object.create(l,{word:{value:t},line:{value:e},left:{value:n},width:{value:i},ordinal:{value:r},length:{value:t.text.length+t.space.length}})}},function(t,e,n){var r=n(4),i=n(6),o=n(2),a=n(1),s=n(5),u=o.derive({parent:function(){return this._parent},draw:function(t){this.inline.draw(t,this.left,this.baseline,this.measured.width,this.measured.ascent,this.measured.descent,this.formatting)},position:function(t,e,n){this.left=t,this.baseline=e,n&&(this._bounds=n)},bounds:function(){return this._bounds||a(this.left,this.baseline-this.measured.ascent,this.measured.width,this.measured.ascent+this.measured.descent)},byCoordinate:function(t,e){return t<=this.bounds().center().x?this:this.next()}}),c={number:function(t,e){var n=e+1+".";return{measure:function(t){return r.measure(n,t)},draw:function(t,e,i,o,a,s,u){r.draw(t,n,u,e,i,o,a,s)}}}};c.listNext=c.listEnd=function(t){return s.derive(t,{eof:!0,measure:function(t){return{width:18,ascent:0,descent:0}},draw:function(t,e,n){}})},c.listStart=function(t,e,n){return s.derive(t,{block:function(e,r,s,c,l,f){var h,d,p,v=o.generic("list",l,e,r),g=function(t,a){h=o.generic("item",v);var l=n(t.marker||{$:"number"},v.children().length);(p=function(t,e,n,r,i){if(!t.draw||!t.measure)throw new Error;return Object.create(u,{inline:{value:t},_parent:{value:e},ordinal:{value:n},length:{value:r},formatting:{value:i},measured:{value:t.measure(i)}})}(l,h,c,1,a)).block=!0,d=i(e+50,r,s-50,c+1,h,(function(t){return"listEnd"===t.$}),p.measured.ascent)};return g(t,f),function(t){if(d?d((function(t){c=t.ordinal+t.length;var n=t.bounds(),i=t.first(),o=e+50-10-p.measured.width,s=a(e,r,50,n.h);"baseline"in i?p.position(o,i.baseline,s):p.position(o,r+p.measured.ascent,s),r=n.t+n.h,h.children().push(p),h.children().push(t),h.finalize(),v.children().push(h),h=d=p=null}),t):c++,!d){var n=t.code();if(n){if("listEnd"==n.$)return v.finalize(),v;"listNext"==n.$&&g(n,t.codeFormatting())}}}}})},t.exports=e=function(t,e,n){var r=c[t.$];return r&&r(t,e,n)},e.editFilter=function(t){var e=0;if(!t.words.some((function(n,r){var i=n.code();if(i)switch(i.$){case"listStart":e++;break;case"listNext":if(0===e)return t.spliceWordsWithRuns(r,1,[s.derive(n.codeFormatting(),{text:{$:"listStart",marker:i.marker}})]),!0;break;case"listEnd":0===e&&t.spliceWordsWithRuns(r,1,[]),e--}}))&&e>0){for(var n=[];e>0;)e--,n.push({text:{$:"listEnd"}});t.spliceWordsWithRuns(t.words.length-1,0,n)}}},function(t,e,n){var r=n(0),i=n(3),o=function(t,e){return function(n,r){n.nodeName===t&&(r[e]=!0)}},a=function(t,e,n,r){return function(i,o){var a=i[t]&&i[t][e];a&&(r&&(a=r(a)),o[n]=a)}},s=function(t,e,n){return a("attributes",t,e,n)},u=function(t,e,n){return a("style",t,e,n)},c=function(t,e,n){return function(r,i){r.style&&r.style[t]===e&&(i[n]=!0)}},l=[6,7,9,10,12,16,20,30],f={left:!0,center:!0,right:!0,justify:!0},h=function(t){return f[t]?t:"left"},d=function(t){var e=t.split(/\s*,\s*/g);if(0==e.length)return t;var n=(t=e[0]).match(/^"(.*)"$/);return n?n[1].trim():(n=t.match(/^'(.*)'$/))?n[1].trim():t},p={H1:30,H2:20,H3:16,H4:14,H5:12},v=[o("B","bold"),o("STRONG","bold"),o("I","italic"),o("EM","italic"),o("U","underline"),o("S","strikeout"),o("STRIKE","strikeout"),o("DEL","strikeout"),c("fontWeight","bold","bold"),c("fontStyle","italic","italic"),c("textDecoration","underline","underline"),c("textDecoration","line-through","strikeout"),u("color","color"),u("fontFamily","font",d),u("fontSize","size",(function(t){var e=t.match(/^([\d\.]+)pt$/);return e?parseFloat(e[1]):10})),u("textAlign","align",h),function(t,e){"SUB"===t.nodeName&&(e.script="sub")},function(t,e){"SUPER"===t.nodeName&&(e.script="super")},function(t,e){"CODE"===t.nodeName&&(e.font="monospace")},function(t,e){var n=p[t.nodeName];n&&(e.size=n)},s("color","color"),s("face","font",d),s("align","align",h),s("size","size",(function(t){return l[t]||10}))],g={};["BR","P","H1","H2","H3","H4","H5"].forEach((function(t){g[t]=!0})),e.parse=function(t,e){var n=t;"string"==typeof n&&((n=document.createElement("div")).innerHTML=t);var o=[],a=!0,s=i(r.consolidate()).into(o),u=function(t,e){s.submit(Object.create(e,{text:{value:t}}))},c=function(t,e){var n=(t=t.replace(/\n+\s*/g," ")).length;t=t.replace(/^\s+/,""),a?a=!1:n!==t.length&&(t=" "+t),(n=t.length)!==(t=t.replace(/\s+$/,"")).length&&(a=!0,t+=" "),u(t,e)};return function t(n,r){if(3==n.nodeType)c(n.nodeValue,r);else{r=Object.create(r);var i=n.attributes.class;if(i&&i.value.split(" ").forEach((function(t){(t=e[t])&&Object.keys(t).forEach((function(e){r[e]=t[e]}))})),v.forEach((function(t){t(n,r)})),n.childNodes)for(var o=0;o<n.childNodes.length;o++)t(n.childNodes[o],r);g[n.nodeName]&&(u("\n",r),a=!0)}}(n,{}),o}}]);
