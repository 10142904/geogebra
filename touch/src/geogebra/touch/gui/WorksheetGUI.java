package geogebra.touch.gui;

import geogebra.common.main.App;
import geogebra.common.move.ggtapi.models.Material;
import geogebra.html5.main.AppWeb;
import geogebra.touch.FileManagerM;
import geogebra.touch.TouchApp;
import geogebra.touch.TouchEntryPoint;
import geogebra.touch.gui.elements.header.WorksheetHeaderPanel;
import geogebra.web.Web;

import com.google.gwt.core.client.Scheduler;
import com.google.gwt.core.client.Scheduler.ScheduledCommand;
import com.google.gwt.user.client.Window;
import com.google.gwt.user.client.ui.DockLayoutPanel;
import com.google.gwt.user.client.ui.FlowPanel;
import com.google.gwt.user.client.ui.HeaderPanel;
import com.google.gwt.user.client.ui.Label;

public class WorksheetGUI extends HeaderPanel {
    private static final String TRIANGLE_ARTICLE = "<article class=\"geogebraweb\" data-param-ggbBase64=\"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\" data-param-width=\"700\" data-param-height=\"620\" data-param-enableRightClick=\"true\" data-param-enableLabelDrags=\"true\" data-param-enableShiftDragZoom=\"false\" data-param-showMenuBar=\"false\" data-param-showToolBar=\"false\" data-param-showAlgebraInput=\"false\" data-param-showResetIcon=\"true\" data-param-useBrowserForJS=\"false\" data-param-framePossible=\"false\" style=\"border=0px solid rgb(0,0,0);display=inline-block\"></article>";
    private final Label instructionsPost, instructionsPre;
    private final FlowPanel frame = new FlowPanel();
    private final WorksheetHeaderPanel header;
    private final AppWeb app;
    private final FileManagerM fm;
    private final FlowPanel content;
    TabletGUI tabletGUI;
    private DockLayoutPanel contentPanel;

    public WorksheetGUI(AppWeb app, TabletGUI tabletGUI) {
	this.setStyleName("worksheetgui");
	this.fm = ((TouchApp) app).getFileManager();
	this.header = new WorksheetHeaderPanel(app, this, tabletGUI);
	this.setHeaderWidget(this.header);
	this.content = new FlowPanel();
	this.app = app;
	this.tabletGUI = tabletGUI;

	this.instructionsPost = new Label();
	this.instructionsPre = new Label();
	this.instructionsPre.setStyleName("instructionsPre");
	this.instructionsPost.setStyleName("instructionsPost");
    }

    public DockLayoutPanel getContentPanel() {
	return this.contentPanel;
    }

    public void loadWorksheet(Material m) {
	this.header.setMaterial(m);
	this.contentPanel = this.tabletGUI.getContentPanel();

	if (m.getId() > 0) {
	    this.content.add(this.instructionsPre);
	    this.content.add(this.frame);
	    this.content.add(this.instructionsPost);
	    this.setContentWidget(this.content);

	    TouchEntryPoint.allowEditing(false);
	    this.frame.getElement().setInnerHTML(TRIANGLE_ARTICLE);

	    /*
	     * .setUrl("http://www.geogebratube.org/student/e" + m.getId() +
	     * "?mobile=true&touch=true&width=" + m.getWidth() + "&height=" +
	     * m.getHeight());
	     */
	    Web.loadAppletAsync();
	    this.frame.setPixelSize(m.getWidth() + 2, m.getHeight() + 2);
	    this.instructionsPre.setText(m.getInstructionsPre());
	    this.instructionsPost.setText(m.getInstructionsPost());
	} else {
	    TouchEntryPoint.allowEditing(false);
	    this.fm.getMaterial(m, this.app);
	    this.setContentWidget(this.contentPanel);
	    this.updateViewSize();
	}

	Scheduler.get().scheduleDeferred(new ScheduledCommand() {
	    @Override
	    public void execute() {
		WorksheetGUI.this.tabletGUI.updateViewSizes(WorksheetGUI.this.tabletGUI.isAlgebraShowing());
	    }
	});
	App.debug("loading" + m.getTitle());
    }

    public void setLabels() {
	this.header.setLabels();
    }

    private void updateViewSize() {
	this.contentPanel.setPixelSize(Window.getClientWidth(), Window.getClientHeight() - TouchEntryPoint.getLookAndFeel().getAppBarHeight());
    }
}
