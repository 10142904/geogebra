/* Introducing the OpenGL ES 2 Fragment shader
 *
 * The main loop of the fragment shader gets executed for each visible
 * pixel fragment on the render buffer.
 *
 *       vertex-> *
 *      (0,1,-1) /f\
 *              /ffF\ <- This fragment F gl_FragCoord get interpolated
 *             /fffff\                   to (0.25,0.25,-1) based on the
 *   vertex-> *fffffff* <-vertex         three vertex gl_Position.
 *  (-1,-1,-1)           (1,-1,-1)
 *
 *
 * All incomming "varying" and gl_FragCoord data to the fragment shader
 * gets interpolated based on the vertex positions.
 *
 * The fragment shader produce and store the final color data output into
 * gl_FragColor.
 *
 * Is up to you to set the final colors and calculate lightning here based on
 * supplied position, color and normal data.
 *
 * The whole fragment shader program are a String containing GLSL ES language
 * http://www.khronos.org/registry/gles/specs/2.0/GLSL_ES_Specification_1.0.17.pdf
 * sent to the GPU driver for compilation.
 */

#if __VERSION__ >= 130
  #define varying in
  out vec4 mgl_FragColor;
  #define texture2D texture
  #define gl_FragColor mgl_FragColor
#endif 

#ifdef GL_ES 
precision mediump float; 
precision mediump int; 
#endif 





// uniform
uniform int fading;
uniform int texturesEnabled;
uniform int hasTexture;

// in (incomming varying data to the frament shader sent from the vertex shader)
varying   vec4    varying_Color;  
varying   vec2	  coordTexture;  




void main (void) 
{ 
	
	gl_FragColor.xyz  = varying_Color.xyz;
	
	if (texturesEnabled == 1 && hasTexture == 1){
		// first test if there is a fading (e.g. for plane edges)
		if (fading == 1){
			float factor;
			float x = coordTexture.x;
			float y = coordTexture.y;
			if (x < 0){
				x = 0;
			}
			if (y < 0){
				y = 0;
			}
			gl_FragColor.a = varying_Color.a * (1 - x) * (1 - y);
		}else{
			float x = mod(coordTexture.x, 1);
			if (x > 0.5){
				discard; // don't write
			}else{
				gl_FragColor.a = varying_Color.a;
			}	
		}
	}else{
		gl_FragColor.a = varying_Color.a;
	}
	  

} 


